<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.codingpupii.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://www.codingpupii.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="pupil">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.codingpupii.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-05-20 00:00:00 / Modified: 15:24:02" itemprop="dateCreated datePublished" datetime="2021-05-20T00:00:00+08:00">2021-05-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a><font color="darkblue">设计模式</font></h1><h2 id="构建型模式"><a href="#构建型模式" class="headerlink" title="构建型模式"></a><font color="blue">构建型模式</font></h2><h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a><font color="darkgreen">工厂模式</font></h3><h4 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a><font color="purple">简单工厂模式</font></h4><p>水果工厂：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Fruit <span class="title">create</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;苹果&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> Apple();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;梨子&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> Pear();</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;暂时没有这种水果&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用者：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FruitFactory fruitFactory = <span class="keyword">new</span> FruitFactory();</span><br><span class="line">        Fruit apple = fruitFactory.create(<span class="string">&quot;苹果&quot;</span>);</span><br><span class="line">        Fruit pear = fruitFactory.create(<span class="string">&quot;梨子&quot;</span>);</span><br><span class="line">        apple.eat();</span><br><span class="line">        pear.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%9D%A2%E7%BB%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%9D%A2%E7%BB%8F/" class="post-title-link" itemprop="url">设计模式面经</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-20T00:00:00+08:00">2021-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-29 10:09:59" itemprop="dateModified" datetime="2021-05-29T10:09:59+08:00">2021-05-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-（京东、网易）设计模式都了解哪些？单例模式的懒汉式和饿汉式？注意什么？"><a href="#1-（京东、网易）设计模式都了解哪些？单例模式的懒汉式和饿汉式？注意什么？" class="headerlink" title="1.（京东、网易）设计模式都了解哪些？单例模式的懒汉式和饿汉式？注意什么？"></a>1.（京东、网易）设计模式都了解哪些？单例模式的懒汉式和饿汉式？注意什么？</h1><p>（2）<br>——饿汉式：变量在声明时便初始化。饿汉式有一个弊端，那就是即使这个单例不需要使用，它也会在类加载之后立即创建出来，占用一块内存，并增加类初始化时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>——懒汉式：先声明一个空变量，需要用时才初始化。我们先声明了一个初始值为 null 的 instance 变量，当需要使用时判断此变量是否已被初始化，没有初始化的话才 new 一个实例出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3)<br>懒汉式单例乍一看没什么问题，但其实它不是线程安全的。<br>JVM 底层为了优化程序运行效率，可能会对我们的代码进行指令重排序，在一些特殊情况下会导致出现空指针，为了防止这个问题，更进一步的优化是给 instance 变量加上 volatile 关键字。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-（字节）装饰和模板"><a href="#2-（字节）装饰和模板" class="headerlink" title="2.（字节）装饰和模板"></a>2.（字节）装饰和模板</h1><p>装饰：</p>
<p>动态的给一个对象附加额外的功能，这也是子类的一种替代方式。可以看到，在创建一个类型的时候，同时也传入同一类型的对象。这在JDK 里随处可见，你会发现它无处不在，所以下面这个列表只是一小部分。装饰原有对象、在不改变原有对象的情况下扩展增强新功能/新特征.。当不能采用继承的方式对系统进行扩展或者采用继承不利于系统扩展和维护时可以使用装饰模式。</p>
<p>Jdk : 装饰者模式通过包含一个原有的Inputstream 对象， 并且将InputStream 原有的方法或直接暴露，或进行装饰后暴露，又或者添加了新的特性，如DataInputStream 中的readInt()，BufferedInputStream 中的缓存功能。(这些新的功能就是装饰后新添加的）<br><strong>java.io.BufferedInputStream(InputStream)</strong><br><strong>java.io.DataInputStream(InputStream)</strong><br><strong>java.io.BufferedOutputStream(OutputStream)</strong><br><strong>java.util.zip.ZipOutputStream(OutputStream)</strong></p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/leetbook/read/design-patterns/99j7re/">https://leetcode-cn.com/leetbook/read/design-patterns/99j7re/</a></p>
<p>模板方法模式：<br>让子类可以重写方法的一部分，而不是整个重写，你可以控制子类需要重写那些操作。</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/leetbook/read/design-patterns/9ena36/">https://leetcode-cn.com/leetbook/read/design-patterns/9ena36/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A2%E7%BB%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%9D%A2%E7%BB%8F/" class="post-title-link" itemprop="url">操作系统面经</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-18 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-18T00:00:00+08:00">2021-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-14 16:41:52" itemprop="dateModified" datetime="2021-06-14T16:41:52+08:00">2021-06-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-（美团、京东、字节、瓜子）进程和线程的区别？"><a href="#1-（美团、京东、字节、瓜子）进程和线程的区别？" class="headerlink" title="1.（美团、京东、字节、瓜子）进程和线程的区别？"></a>1.（美团、京东、字节、瓜子）进程和线程的区别？</h1><p>答：</p>
<ol>
<li>进程是CPU资源分配的基本单位，线程是独立运行和独立调度的基本单位（CPU上真正运行的是线程）。</li>
<li>进程拥有自己的资源空间，一个进程包含若干个线程，线程与CPU资源分配无关，多个线程共享同一进程内的资源。</li>
<li>线程的调度与切换比进程快很多。</li>
</ol>
<h1 id="2-（美团、京东、瓜子）进程调度方式"><a href="#2-（美团、京东、瓜子）进程调度方式" class="headerlink" title="2.（美团、京东、瓜子）进程调度方式"></a>2.（美团、京东、瓜子）进程调度方式</h1><p>答：</p>
<p>可抢占式（可剥夺式，preemptive)：就绪队列中一旦有某进程的优先级高于当前正在执行的进程的优先级时，操作系统便立即进行进程调度，完成进程切换。<br>不可抢占式（不可剥夺式non_preemptive）：即使在就绪队列存在有某进程优先级高于当前正在执行的进程的优先级时，当前进程仍将占用处理机执行，直到该进程自己进入阻塞状态，或时间片用完，或在执行完系统调用后准备返回用户进程前的时刻，才重新发生调度让出处理机。</p>
<p><img src="https://cdn.jsdelivr.net/gh/codingPupiI/cdn/1.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/codingPupiI/cdn/2.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/codingPupiI/cdn/3.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/codingPupiI/cdn/4.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/codingPupiI/cdn/5.jpg" alt="img"></p>
<h1 id="3-（京东）了解操作系统吗？"><a href="#3-（京东）了解操作系统吗？" class="headerlink" title="3.（京东）了解操作系统吗？"></a>3.（京东）了解操作系统吗？</h1><h1 id="4-（字节、瓜子）如何避免死锁？"><a href="#4-（字节、瓜子）如何避免死锁？" class="headerlink" title="4.（字节、瓜子）如何避免死锁？"></a>4.（字节、瓜子）如何避免死锁？</h1><h3 id="1-安全状态"><a href="#1-安全状态" class="headerlink" title="1. 安全状态"></a>1. 安全状态</h3><p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/09589c4bfe0e5514a44fc74cd63069f018b03246880e1f89b887313bbbdf2073/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65643532333035312d363038662d346333662d623334332d3338336532643139343437302e706e67"><img src="https://camo.githubusercontent.com/09589c4bfe0e5514a44fc74cd63069f018b03246880e1f89b887313bbbdf2073/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65643532333035312d363038662d346333662d623334332d3338336532643139343437302e706e67" alt="img"></a></p>
<p>图 a 的第二列 Has 表示已拥有的资源数，第三列 Max 表示总共需要的资源数，Free 表示还有可以使用的资源数。从图 a 开始出发，先让 B 拥有所需的所有资源（图 b），运行结束后释放 B，此时 Free 变为 5（图 c）；接着以同样的方式运行 C 和 A，使得所有进程都能成功运行，因此可以称图 a 所示的状态时安全的。</p>
<p>定义：如果没有死锁发生，并且即使所有进程突然请求对资源的最大需求，也仍然存在某种调度次序能够使得每一个进程运行完毕，则称该状态是安全的。</p>
<p>安全状态的检测与死锁的检测类似，因为安全状态必须要求不能发生死锁。下面的银行家算法与死锁检测算法非常类似，可以结合着做参考对比。</p>
<h3 id="2-单个资源的银行家算法"><a href="#2-单个资源的银行家算法" class="headerlink" title="2. 单个资源的银行家算法"></a>2. 单个资源的银行家算法</h3><p>一个小城镇的银行家，他向一群客户分别承诺了一定的贷款额度，算法要做的是判断对请求的满足是否会进入不安全状态，如果是，就拒绝请求；否则予以分配。</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/381663ffc7a4db80478e5f454a11400debf6c13628632e3396fdaa7a6e555716/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f64313630656332652d636665322d343634302d626461372d3632663533653538623863302e706e67"><img src="https://camo.githubusercontent.com/381663ffc7a4db80478e5f454a11400debf6c13628632e3396fdaa7a6e555716/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f64313630656332652d636665322d343634302d626461372d3632663533653538623863302e706e67" alt="img"></a></p>
<p>上图 c 为不安全状态，因此算法会拒绝之前的请求，从而避免进入图 c 中的状态。</p>
<h3 id="3-多个资源的银行家算法"><a href="#3-多个资源的银行家算法" class="headerlink" title="3. 多个资源的银行家算法"></a>3. 多个资源的银行家算法</h3><p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/5334ac030b7446b89615c4319275fe27330481ac6f1a9280fc682f6dffcf5241/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36326530646434662d343463332d343365652d626236652d6665646239653036383531392e706e67"><img src="https://camo.githubusercontent.com/5334ac030b7446b89615c4319275fe27330481ac6f1a9280fc682f6dffcf5241/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36326530646434662d343463332d343365652d626236652d6665646239653036383531392e706e67" alt="img"></a></p>
<p>上图中有五个进程，四个资源。左边的图表示已经分配的资源，右边的图表示还需要分配的资源。最右边的 E、P 以及 A 分别表示：总资源、已分配资源以及可用资源，注意这三个为向量，而不是具体数值，例如 A=(1020)，表示 4 个资源分别还剩下 1/0/2/0。</p>
<p>检查一个状态是否安全的算法如下：</p>
<ul>
<li>查找右边的矩阵是否存在一行小于等于向量 A。如果不存在这样的行，那么系统将会发生死锁，状态是不安全的。</li>
<li>假若找到这样一行，将该进程标记为终止，并将其已分配资源加到 A 中。</li>
<li>重复以上两步，直到所有进程都标记为终止，则状态时安全的。</li>
</ul>
<p>如果一个状态不是安全的，需要拒绝进入这个状态。</p>
<h1 id="5-（字节）如何检测死锁？"><a href="#5-（字节）如何检测死锁？" class="headerlink" title="5.（字节）如何检测死锁？"></a>5.（字节）如何检测死锁？</h1><h3 id="1-每种类型一个资源的死锁检测"><a href="#1-每种类型一个资源的死锁检测" class="headerlink" title="1. 每种类型一个资源的死锁检测"></a>1. 每种类型一个资源的死锁检测</h3><p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/5663be4d3b58da1b738412ca4854b61d255974230c1c88875f96511618a5bae0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62316661303435332d613462302d346561652d613335322d3438616363613866666637342e706e67"><img src="https://camo.githubusercontent.com/5663be4d3b58da1b738412ca4854b61d255974230c1c88875f96511618a5bae0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62316661303435332d613462302d346561652d613335322d3438616363613866666637342e706e67" alt="img"></a></p>
<p>上图为资源分配图，其中方框表示资源，圆圈表示进程。资源指向进程表示该资源已经分配给该进程，进程指向资源表示进程请求获取该资源。</p>
<p>图 a 可以抽取出环，如图 b，它满足了环路等待条件，因此会发生死锁。</p>
<p>每种类型一个资源的死锁检测算法是通过检测有向图是否存在环来实现，从一个节点出发进行深度优先搜索，对访问过的节点进行标记，如果访问了已经标记的节点，就表示有向图存在环，也就是检测到死锁的发生。</p>
<h3 id="2-每种类型多个资源的死锁检测"><a href="#2-每种类型多个资源的死锁检测" class="headerlink" title="2. 每种类型多个资源的死锁检测"></a>2. 每种类型多个资源的死锁检测</h3><p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/65aa9be0a5faea5fb50ec17101ce3e900688ad9079ac67fed8bb7fb40c8578f1/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65316564613364352d356563382d343730382d386532352d3161303463356531316634382e706e67"><img src="https://camo.githubusercontent.com/65aa9be0a5faea5fb50ec17101ce3e900688ad9079ac67fed8bb7fb40c8578f1/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65316564613364352d356563382d343730382d386532352d3161303463356531316634382e706e67" alt="img"></a></p>
<p>上图中，有三个进程四个资源，每个数据代表的含义如下：</p>
<ul>
<li>E 向量：资源总量</li>
<li>A 向量：资源剩余量</li>
<li>C 矩阵：每个进程所拥有的资源数量，每一行都代表一个进程拥有资源的数量</li>
<li>R 矩阵：每个进程请求的资源数量</li>
</ul>
<p>进程 P1 和 P2 所请求的资源都得不到满足，只有进程 P3 可以，让 P3 执行，之后释放 P3 拥有的资源，此时 A = (2 2 2 0)。P2 可以执行，执行后释放 P2 拥有的资源，A = (4 2 2 1) 。P1 也可以执行。所有进程都可以顺利执行，没有死锁。</p>
<p>算法总结如下：</p>
<p>每个进程最开始时都不被标记，执行过程有可能被标记。当算法结束时，任何没有被标记的进程都是死锁进程。</p>
<ol>
<li>寻找一个没有标记的进程 Pi，它所请求的资源小于等于 A。</li>
<li>如果找到了这样一个进程，那么将 C 矩阵的第 i 行向量加到 A 中，标记该进程，并转回 1。</li>
<li>如果没有这样一个进程，算法终止。</li>
</ol>
<h1 id="6-（瓜子）进程切换与线程切换"><a href="#6-（瓜子）进程切换与线程切换" class="headerlink" title="6.（瓜子）进程切换与线程切换"></a>6.（瓜子）进程切换与线程切换</h1><h1 id="7-（瓜子）进程通讯方式"><a href="#7-（瓜子）进程通讯方式" class="headerlink" title="7.（瓜子）进程通讯方式"></a>7.（瓜子）进程通讯方式</h1><h1 id="8-（瓜子）线程通讯方式"><a href="#8-（瓜子）线程通讯方式" class="headerlink" title="8.（瓜子）线程通讯方式"></a>8.（瓜子）线程通讯方式</h1><h1 id="9-（瓜子）产生死锁的原因"><a href="#9-（瓜子）产生死锁的原因" class="headerlink" title="9.（瓜子）产生死锁的原因"></a>9.（瓜子）产生死锁的原因</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/" class="post-title-link" itemprop="url">MySql面经</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-16T00:00:00+08:00">2021-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-21 19:03:06" itemprop="dateModified" datetime="2021-06-21T19:03:06+08:00">2021-06-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-（京东、瓜子）谈谈MySQL索引是怎么实现的？为什么要这样实现？有别的实现方式吗？"><a href="#1-（京东、瓜子）谈谈MySQL索引是怎么实现的？为什么要这样实现？有别的实现方式吗？" class="headerlink" title="1.（京东、瓜子）谈谈MySQL索引是怎么实现的？为什么要这样实现？有别的实现方式吗？"></a>1.（京东、瓜子）谈谈MySQL索引是怎么实现的？为什么要这样实现？有别的实现方式吗？</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bypp/p/7755307.html">https://www.cnblogs.com/bypp/p/7755307.html</a></p>
<p>（1）</p>
<p><strong>索引是一种用于快速查询和检索数据的数据结构。常见的索引结构有: B 树， B+树和 Hash。</strong></p>
<p>（2）</p>
<p><strong>B+树更有利于对数据库的扫描</strong><br>B 树在提高了磁盘IO 性能的同时并没有解决元素遍历的效率低下的问题，而B+树只需要遍历叶子节点就可以解决对全部关键字信息的扫描，所以对于数据库中频繁使用的range query，B+树有着更高的性能。<br><strong>B+树的磁盘读写代价更低</strong><br>B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说I/O 读写次数也就降低了。<br><strong>B+树的查询效率更加稳定</strong><br>由于内部结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</p>
<h1 id="2-（京东）聚簇索引和非聚簇索引？"><a href="#2-（京东）聚簇索引和非聚簇索引？" class="headerlink" title="2.（京东）聚簇索引和非聚簇索引？"></a>2.（京东）聚簇索引和非聚簇索引？</h1><h3 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h3><p><strong>聚集索引即索引结构和数据一起存放的索引。主键索引属于聚集索引。</strong></p>
<p>在 Mysql 中，InnoDB 引擎的表的 <code>.ibd</code>文件就包含了该表的索引和数据，对于 InnoDB 引擎表来说，该表的索引(B+树)的每个非叶子节点存储索引，叶子节点存储索引和索引对应的数据。</p>
<h4 id="聚集索引的优点"><a href="#聚集索引的优点" class="headerlink" title="聚集索引的优点"></a>聚集索引的优点</h4><p>聚集索引的查询速度非常的快，因为整个 B+树本身就是一颗多叉平衡树，叶子节点也都是有序的，定位到索引的节点，就相当于定位到了数据。</p>
<h4 id="聚集索引的缺点"><a href="#聚集索引的缺点" class="headerlink" title="聚集索引的缺点"></a>聚集索引的缺点</h4><p>1.<strong>依赖于有序的数据</strong> ：因为 B+树是多路平衡树，如果索引的数据不是有序的，那么就需要在插入时排序，如果数据是整型还好，否则类似于字符串或 UUID 这种又长又难比较的数据，插入或查找的速度肯定比较慢。<br>2.<strong>更新代价大</strong> ： 如果对索引列的数据被修改时，那么对应的索引也将会被修改， 而且况聚集索引的叶子节点还存放着数据，修改代价肯定是较大的， 所以对于主键索引来说，主键一般都是不可被修改的。</p>
<h3 id="非聚集索引"><a href="#非聚集索引" class="headerlink" title="非聚集索引"></a>非聚集索引</h3><p><strong>非聚集索引即索引结构和数据分开存放的索引。</strong></p>
<p><strong>二级索引属于非聚集索引。</strong></p>
<p>MYISAM 引擎的表的.MYI 文件包含了表的索引， 该表的索引(B+树)的每个叶子非叶子节点存储索引， 叶子节点存储索引和索引对应数据的指针，指向.MYD 文件的数据。</p>
<p><strong>非聚集索引的叶子节点并不一定存放数据的指针， 因为二级索引的叶子节点就存放的是主键，根据主键再回表查数据。</strong></p>
<h4 id="非聚集索引的优点"><a href="#非聚集索引的优点" class="headerlink" title="非聚集索引的优点"></a>非聚集索引的优点</h4><p><strong>更新代价比聚集索引要小</strong> 。非聚集索引的更新代价就没有聚集索引那么大了，非聚集索引的叶子节点是不存放数据的</p>
<h4 id="非聚集索引的缺点"><a href="#非聚集索引的缺点" class="headerlink" title="非聚集索引的缺点"></a>非聚集索引的缺点</h4><ol>
<li>跟聚集索引一样，非聚集索引也依赖于有序的数据</li>
<li><strong>可能会二次查询(回表)</strong> :这应该是非聚集索引最大的缺点了。 当查到索引对应的指针或主键后，可能还需要根据指针或主键再到数据文件或表中查询。</li>
</ol>
<p>这是 MySQL 的表的文件截图:</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/bbf40c980ab863e7ff3aa28d46e98ce7214b52ba606af5349230da758fa51e6f/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303432303136353331313635342e706e67"><img src="https://camo.githubusercontent.com/bbf40c980ab863e7ff3aa28d46e98ce7214b52ba606af5349230da758fa51e6f/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303432303136353331313635342e706e67" alt="img"></a></p>
<p>聚集索引和非聚集索引:</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/478e8ec7d788f11aa63079a2745d8a62eff36e612c5e7c65f4478d523b3ab569/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303432303136353332363934362e706e67"><img src="https://camo.githubusercontent.com/478e8ec7d788f11aa63079a2745d8a62eff36e612c5e7c65f4478d523b3ab569/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303432303136353332363934362e706e67" alt="img"></a></p>
<h1 id="3-（京东）JDBC了解吗？使用的流程？两个Statement的区别？SQL注入是什么？"><a href="#3-（京东）JDBC了解吗？使用的流程？两个Statement的区别？SQL注入是什么？" class="headerlink" title="3.（京东）JDBC了解吗？使用的流程？两个Statement的区别？SQL注入是什么？"></a>3.（京东）JDBC了解吗？使用的流程？两个Statement的区别？SQL注入是什么？</h1><p>（2）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以mysql为例</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException</span>&#123;</span><br><span class="line">	<span class="comment">/*1.注册驱动（3种方法），依赖于驱动jar包的存在，否则无法通过编译</span></span><br><span class="line"><span class="comment">	DriverManager.registerDriver(new com.mysql.jdbc.Driver());*/</span></span><br><span class="line">	<span class="comment">//方法2：System.setProperties(&quot;jdbc.drivers&quot;,&quot;com.mysql.jdbc.Driver&quot;);</span></span><br><span class="line">	<span class="comment">//方法3：*****推荐使用******</span></span><br><span class="line">	Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.建立连接</span></span><br><span class="line">    Connection </span><br><span class="line">        conn=DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:8086/jdbc&quot;</span>,<span class="string">&quot;zhipeng&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="comment">//3.创建语句执行对象</span></span><br><span class="line">    java.sql.Statement st=conn.createStatement();<span class="comment">//使用Statement对象</span></span><br><span class="line">    <span class="comment">//4.执行语句</span></span><br><span class="line">    ResultSet rs=st.executeQuery(<span class="string">&quot;select * from T_User&quot;</span>);</span><br><span class="line">    <span class="comment">//5.处理结果</span></span><br><span class="line">    <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    System.out.print(rs.getObject(<span class="number">1</span>)+<span class="string">&quot;\t&quot;</span>+rs.getObject(<span class="number">2</span>)+<span class="string">&quot;\t&quot;</span>+rs.getObject(<span class="number">3</span>)+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.释放资源,资源rs、st、conn的释放顺序与创建顺序相反</span></span><br><span class="line">    rs.close();</span><br><span class="line">    st.close();</span><br><span class="line">    conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（3）</p>
<h1 id="4-（腾迅）redis-数据结构介绍一下"><a href="#4-（腾迅）redis-数据结构介绍一下" class="headerlink" title="4.（腾迅）redis 数据结构介绍一下"></a>4.（腾迅）redis 数据结构介绍一下</h1><h1 id="5-（腾迅，shopee）索引类型，哈希索引和B-数索引区别，说了下为啥B-树"><a href="#5-（腾迅，shopee）索引类型，哈希索引和B-数索引区别，说了下为啥B-树" class="headerlink" title="5.（腾迅，shopee）索引类型，哈希索引和B+数索引区别，说了下为啥B+树"></a>5.（腾迅，shopee）索引类型，哈希索引和B+数索引区别，说了下为啥B+树</h1><p>（1）</p>
<p><img src="/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512154042627.png" alt="image-20210512154042627"></p>
<p><img src="/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512154056860.png" alt="image-20210512154056860"></p>
<p>（2）</p>
<p>B+树索引和哈希索引的明显区别是：</p>
<ul>
<li><strong>如果是等值查询，那么哈希索引明显有绝对优势</strong>，因为只需要经过一次算法即可找到相应的键值；当然了，这个前提是，键值都是唯一的。如果键值不是唯一的，就需要先找到该键所在位置，然后再根据链表往后扫描，直到找到相应的数据；</li>
<li>从示意图中也能看到，<strong>如果是范围查询检索，这时候哈希索引就毫无用武之地了</strong>，因为原先是有序的键值，经过哈希算法后，有可能变成不连续的了，就没办法再利用索引完成范围查询检索；</li>
<li>同理，<strong>哈希索引也没办法利用索引完成排序</strong>，以及like ‘xxx%’ 这样的部分模糊查询（这种部分模糊查询，其实本质上也是范围查询）；</li>
<li><strong>哈希索引也不支持多列联合索引的最左匹配规则</strong>；</li>
<li>B+树索引的关键字检索效率比较平均，不像B树那样波动幅度大，<strong>在有大量重复键值情况下，哈希索引的效率也是极低的，因为存在所谓的哈希碰撞问题</strong>。</li>
</ul>
<p>（3）</p>
<p><strong>B+树更有利于对数据库的扫描</strong><br>B 树在提高了磁盘IO 性能的同时并没有解决元素遍历的效率低下的问题，而B+树只需要遍历叶子节点就可以解决对全部关键字信息的扫描，所以对于数据库中频繁使用的range query，B+树有着更高的性能。<br><strong>B+树的磁盘读写代价更低</strong><br>B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说I/O 读写次数也就降低了。<br><strong>B+树的查询效率更加稳定</strong><br>由于内部结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</p>
<h1 id="6-（shopee、瓜子）四个隔离级别"><a href="#6-（shopee、瓜子）四个隔离级别" class="headerlink" title="6.（shopee、瓜子）四个隔离级别"></a>6.（shopee、瓜子）四个隔离级别</h1><p>答：</p>
<ul>
<li><img src="/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210609094131040.png" alt="image-20210609094131040">4</li>
<li><img src="/2021/05/16/MySql%E9%9D%A2%E7%BB%8F/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210609094158461.png" alt="image-20210609094158461"></li>
</ul>
<p>大多数数据库的默认级别就是Read committed，比如Sql Server , Oracle。MySQL的默认隔离级别就是Repeatable read。</p>
<h1 id="7-（美团、字节）乐观锁悲观锁"><a href="#7-（美团、字节）乐观锁悲观锁" class="headerlink" title="7.（美团、字节）乐观锁悲观锁"></a>7.（美团、字节）乐观锁悲观锁</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d2ac26ca6525">https://www.jianshu.com/p/d2ac26ca6525</a></p>
<h1 id="8-（shopee）主从同步如何实现"><a href="#8-（shopee）主从同步如何实现" class="headerlink" title="8.（shopee）主从同步如何实现"></a>8.（shopee）主从同步如何实现</h1><h1 id="9-（字节跳动）死锁产生的4个必要条件"><a href="#9-（字节跳动）死锁产生的4个必要条件" class="headerlink" title="9.（字节跳动）死锁产生的4个必要条件"></a>9.（字节跳动）<strong>死锁产生的4个必要条件</strong></h1><p>​    1、互斥： 某种资源一次只允许一个进程访问，即该资源一旦分配给某个进程，其他进程就不能再访问，直到该进程访问结束。<br>​    2、占有且等待： 一个进程本身占有资源（一种或多种），同时还有资源未得到满足，正在等待其他进程释放该资源。<br>​    3、不可抢占： 别人已经占有了某项资源，你不能因为自己也需要该资源，就去把别人的资源抢过来。<br>​    4、循环等待： 存在一个进程链，使得每个进程都占有下一个进程所需的至少一种资源。<br>​        当以上四个条件均满足，必然会造成死锁，发生死锁的进程无法进行下去，它们所持有的资源也无法释放。这样会导致CPU的吞吐量下降。所以死锁情况是会浪费系统资源和影响计算机的使用性能的。那么，解决死锁问题就是相当有必要的了。</p>
<h1 id="10-（网易）mysql主键是怎么自增的"><a href="#10-（网易）mysql主键是怎么自增的" class="headerlink" title="10.（网易）mysql主键是怎么自增的"></a>10.（网易）mysql主键是怎么自增的</h1><h1 id="11-（网易）针对网易云音乐的评论怎么建表和建索引"><a href="#11-（网易）针对网易云音乐的评论怎么建表和建索引" class="headerlink" title="11.（网易）针对网易云音乐的评论怎么建表和建索引"></a>11.（网易）针对网易云音乐的评论怎么建表和建索引</h1><h1 id="12-（字节）数据库中是否会出现死锁？数据库中的死锁避免是否可用刚才说的方法来避免？"><a href="#12-（字节）数据库中是否会出现死锁？数据库中的死锁避免是否可用刚才说的方法来避免？" class="headerlink" title="12.（字节）数据库中是否会出现死锁？数据库中的死锁避免是否可用刚才说的方法来避免？"></a>12.（字节）数据库中是否会出现死锁？数据库中的死锁避免是否可用刚才说的方法来避免？</h1><h1 id="13-（字节）如果进程一次锁住数据库中的多条记录来避免死锁，会带来什么问题？你觉得应该怎样解决这个问题？"><a href="#13-（字节）如果进程一次锁住数据库中的多条记录来避免死锁，会带来什么问题？你觉得应该怎样解决这个问题？" class="headerlink" title="13.（字节）如果进程一次锁住数据库中的多条记录来避免死锁，会带来什么问题？你觉得应该怎样解决这个问题？"></a>13.（字节）如果进程一次锁住数据库中的多条记录来避免死锁，会带来什么问题？你觉得应该怎样解决这个问题？</h1><h1 id="14-（字节）如果数据库中的确发生了死锁，应该怎么解决？"><a href="#14-（字节）如果数据库中的确发生了死锁，应该怎么解决？" class="headerlink" title="14.（字节）如果数据库中的确发生了死锁，应该怎么解决？"></a>14.（字节）如果数据库中的确发生了死锁，应该怎么解决？</h1><h1 id="15-（字节）说一下数据库中左连接是怎么做的"><a href="#15-（字节）说一下数据库中左连接是怎么做的" class="headerlink" title="15.（字节）说一下数据库中左连接是怎么做的"></a>15.（字节）说一下数据库中左连接是怎么做的</h1><h1 id="16-（字节）说说如何优化连接操作？"><a href="#16-（字节）说说如何优化连接操作？" class="headerlink" title="16.（字节）说说如何优化连接操作？"></a>16.（字节）说说如何优化连接操作？</h1><h1 id="17-（字节）数据库连接池怎么设计的？用什么数据结构？"><a href="#17-（字节）数据库连接池怎么设计的？用什么数据结构？" class="headerlink" title="17.（字节）数据库连接池怎么设计的？用什么数据结构？"></a>17.（字节）数据库连接池怎么设计的？用什么数据结构？</h1><h1 id="18-（字节）连接池满了，此时要建立新的连接怎么办"><a href="#18-（字节）连接池满了，此时要建立新的连接怎么办" class="headerlink" title="18.（字节）连接池满了，此时要建立新的连接怎么办"></a>18.（字节）连接池满了，此时要建立新的连接怎么办</h1><h1 id="19-（字节）数据库事务和四个特性"><a href="#19-（字节）数据库事务和四个特性" class="headerlink" title="19.（字节）数据库事务和四个特性"></a>19.（字节）数据库事务和四个特性</h1><p>事务（Transaction）是并发控制的基本单位。所谓的事务，它是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。事务是数据库维护数据一致性的单位，在每个事务结束时，都能保持数据一致性。</p>
<p>1、原子性（Atomicity）</p>
<p>原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚，因此事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响。</p>
<p>2、 一致性（Consistency）</p>
<p>一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态。</p>
<p>拿转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性。</p>
<p>3、隔离性（Isolation）</p>
<p>隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离。</p>
<p>即要达到这么一种效果：对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行。　</p>
<p>4、持久性（Durability）</p>
<p>持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。</p>
<h1 id="20-（字节）分页、分段管理"><a href="#20-（字节）分页、分段管理" class="headerlink" title="20.（字节）分页、分段管理"></a>20.（字节）分页、分段管理</h1><h1 id="21-（字节）B树和B-树区别"><a href="#21-（字节）B树和B-树区别" class="headerlink" title="21.（字节）B树和B+树区别"></a>21.（字节）B树和B+树区别</h1><p>答：1.内部节点中，关键字的个数与其子树的个数相同，不像B 树种，子树的个数总比关键字个数多1 个<br>2.所有指向文件的关键字及其指针都在叶子节点中，不像B 树，有的指向文件的关键字是在内部节点中。换句话说，B+树中，内部节点仅仅起到索引的作用，<br>3.B+在搜索过程中，如果查询和内部节点的关键字一致，那么搜索过程不停止，而是继续向下搜索这个分支，B+为了找到这个关键字的指针。</p>
<h1 id="22-（瓜子）MySQL索引b-树什么情况不适用"><a href="#22-（瓜子）MySQL索引b-树什么情况不适用" class="headerlink" title="22.（瓜子）MySQL索引b+树什么情况不适用"></a>22.（瓜子）MySQL索引b+树什么情况不适用</h1><h1 id="22-（瓜子）MySQL怎么判断索引是否生效"><a href="#22-（瓜子）MySQL怎么判断索引是否生效" class="headerlink" title="22.（瓜子）MySQL怎么判断索引是否生效"></a>22.（瓜子）MySQL怎么判断索引是否生效</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/16/MyBatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/16/MyBatis/" class="post-title-link" itemprop="url">MyBatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-16 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-16T00:00:00+08:00">2021-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-20 15:24:59" itemprop="dateModified" datetime="2021-05-20T15:24:59+08:00">2021-05-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><p><strong>三层的职责</strong></p>
<ol>
<li>界面层（表示层，视图层）： 主要功能是接受 用户的 数据 ，显示请求的处理结果。使用 web页面和用户交互，手机 app也就是表示层的，用户在 app中操作，业务逻辑在服务器端处理。（controller包、springmvc）</li>
<li>业务逻辑层 ：接收表示传递过来的数据，检查数据，计算业务逻辑，调用数据访问层获取数据。（service包，spring）</li>
<li>数据访问层 （持久层）与数据库打交道。主要实现对数据的增、删、改、查。将存储在数据库中的数据提交给业务层，同时将业务层处理的数据保存到数据库 .（dao包，mybatis）</li>
<li>用户 ——&gt; 界面层 ——&gt;业务逻辑层 ——&gt;数据访问层 ——&gt;DB数据库</li>
</ol>
<p><strong>使用 JDBC的缺陷</strong></p>
<ol>
<li>代码比较多，开发效率 低</li>
<li>需要关注 Connection ,Statement, ResultSet对象创建和销毁</li>
<li>对 ResultSet查询的结果，需要自己封装为 List</li>
<li>重复的代码比较多些</li>
<li>业务代码和数据库的操作混在一起</li>
</ol>
<p><strong>mybatis是 MyBatis SQL Mapper Framework for Java （sql映射框架）</strong><br>   1）sql mapper :sql映射<br>         可以把数据库表中的一行数据  映射为 一个java对象。<br>     一行数据可以看做是一个java对象。操作这个对象，就相当于操作表中的数据</p>
<p>   2） Data Access Objects（DAOs） : 数据访问 ， 对数据库执行增删改查。</p>
<p><strong>开发人员做的是： 提供sql语句</strong><br> <strong>最后是：</strong> 开发人员提供sql语句–mybatis处理sql—开发人员得到List集合或java对象（表中的数据）</p>
<p> <strong>总结：</strong><br>  mybatis是一个sql映射框架，提供的数据库的操作能力。增强的JDBC,<br>  使用mybatis让开发人员集中精神写sql就可以了，不必关心Connection,Statement,ResultSet<br>  的创建，销毁，sql的执行。 </p>
<h1 id="二、helloworld"><a href="#二、helloworld" class="headerlink" title="二、helloworld"></a>二、helloworld</h1><p>实现步骤</p>
<p>1.新建表<br>2.加入maven的mybatis坐标，mysql驱动的坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span><span class="comment">&lt;!--所在的目录--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">includes</span>&gt;</span><span class="comment">&lt;!--包括目录下的.properties,.xml 文件都会扫描到--&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.创建实体类，Student–保存表中的一行数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: mybatis_workspace</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Leng</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4.创建持久层的dao接口，定义操作数据库的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">selectStudents</span> <span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.创建一个mybatis使用的配置文件<br>    叫做sql映射文件：写SQL语句的<br>    这个文件是xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  sql映射文件（sql mapper）： 写sql语句的， mybatis会执行这些sql</span></span><br><span class="line"><span class="comment">  1.指定约束文件</span></span><br><span class="line"><span class="comment">     &lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="comment">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line"><span class="comment">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    mybatis-3-mapper.dtd是约束文件的名称， 扩展名是dtd的。</span></span><br><span class="line"><span class="comment">  2.约束文件作用：  限制，检查在当前文件中出现的标签，属性必须符合mybatis的要求。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  3.mapper 是当前文件的根标签，必须的。</span></span><br><span class="line"><span class="comment">    namespace：叫做命名空间，唯一值的， 可以是自定义的字符串。</span></span><br><span class="line"><span class="comment">               要求你使用dao接口的全限定名称。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  4.在当前文件中，可以使用特定的标签，表示数据库的特定操作。</span></span><br><span class="line"><span class="comment">   &lt;select&gt;:表示执行查询，select语句</span></span><br><span class="line"><span class="comment">   &lt;update&gt;:表示更新数据库的操作， 就是在&lt;update&gt;标签中 写的是update sql语句</span></span><br><span class="line"><span class="comment">   &lt;insert&gt;:表示插入， 放的是insert语句</span></span><br><span class="line"><span class="comment">   &lt;delete&gt;:表示删除， 执行的delete语句</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace：必须有值，自定义的唯一字符串 推荐使用：dao接口的全限定名称 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;dao.StudentDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;select&gt;: 查询数据， 标签中必须是select语句</span></span><br><span class="line"><span class="comment">         id: sql语句的自定义名称，推荐使用dao接口中方法名称，</span></span><br><span class="line"><span class="comment">         使用名称表示要执行的sql语句 resultType: 查询语句的返回结果数据类型，使用全限定类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--要执行的sql语句--&gt;</span></span><br><span class="line">     select id,name,email,age from student order by id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>6.创建mybatis的主配置文件<br>    一个项目就一个主配置文件<br>    主配置文件提供了数据库的连接信息和sql映射文件的位置信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--settings：控制mybatis全局行为--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置mybatis输出日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--环境配置： 数据库的连接信息</span></span><br><span class="line"><span class="comment">        default:必须和某个environment的id值一样。</span></span><br><span class="line"><span class="comment">        告诉mybatis使用哪个数据库的连接信息。也就是访问哪个数据库</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mydev&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- environment : 一个数据库信息的配置， 环境</span></span><br><span class="line"><span class="comment">             id:一个唯一值，自定义，表示环境的名称。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mydev&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">               transactionManager ：mybatis的事务类型</span></span><br><span class="line"><span class="comment">                   type: JDBC(表示使用jdbc中的Connection对象的commit，rollback做事务处理)</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">               dataSource:表示数据源，连接数据库的</span></span><br><span class="line"><span class="comment">                  type：表示数据源的类型， POOLED表示使用连接池</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                   driver, user, username, password 是固定的，不能自定义。</span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--数据库的驱动类名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--连接数据库的url字符串--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--访问数据库的用户名--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--密码--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--表示线上的数据库，是项目真实使用的库--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;online&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/onlinedb&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;fhwertwr&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- sql mapper(sql映射文件)的位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--一个mapper标签指定一个文件的位置。</span></span><br><span class="line"><span class="comment">           从类路径开始的路径信息。  target/clasess(类路径)</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;dao\StudentDao.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource=&quot;com/bjpowernode/dao/SchoolDao.xml&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           mybatis的主配置文件： 主要定义了数据库的配置信息， sql映射文件的位置</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           1. 约束文件</span></span><br><span class="line"><span class="comment">           &lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="comment">                PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line"><span class="comment">                &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            mybatis-3-config.dtd：约束文件的名称</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          2. configuration 根标签。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.创建使用mybatis类，通过mybatis访问数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String config = <span class="string">&quot;mybatis.xml&quot;</span>;</span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(config);</span><br><span class="line">            SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">            SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(inputStream);</span><br><span class="line">            SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">            String sqlId = <span class="string">&quot;dao.StudentDao&quot;</span> + <span class="string">&quot;.&quot;</span> + <span class="string">&quot;selectStudents&quot;</span>;</span><br><span class="line">            List&lt;Student&gt; list = sqlSession.selectList(sqlId);</span><br><span class="line">            list.forEach( student -&gt; System.out.println(student) );</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>8.配置日志</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--settings：控制mybatis全局行为--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--设置mybatis输出日志--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="二、insert操作"><a href="#二、insert操作" class="headerlink" title="二、insert操作"></a>二、insert操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">          String config = <span class="string">&quot;mybatis.xml&quot;</span>;</span><br><span class="line">          InputStream inputStream = Resources.getResourceAsStream(config);</span><br><span class="line">          SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">          SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(inputStream);</span><br><span class="line">          SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">          String sqlId = <span class="string">&quot;dao.StudentDao&quot;</span> + <span class="string">&quot;.&quot;</span> + <span class="string">&quot;insertStudent&quot;</span>;</span><br><span class="line">          Student student = <span class="keyword">new</span> Student();</span><br><span class="line">          student.setId(<span class="number">1003</span>);</span><br><span class="line">          student.setName(<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">          student.setEmail(<span class="string">&quot;789@qq.com&quot;</span>);</span><br><span class="line">          student.setAge(<span class="number">20</span>);</span><br><span class="line">          <span class="keyword">int</span> num = sqlSession.insert(sqlId, student);</span><br><span class="line">          sqlSession.commit();</span><br><span class="line">          System.out.println(num);</span><br><span class="line">          sqlSession.close();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--要执行的sql语句--&gt;</span></span><br><span class="line">       insert into student values (#&#123;id&#125;, #&#123;name&#125;, #&#123;email&#125;, #&#123;age&#125;);</span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> <strong>1 主要类的介绍</strong><br>1） <strong>Resources</strong>： mybatis中的一个类， 负责读取主配置文件<br>      InputStream in = Resources.getResourceAsStream(“mybatis.xml”);</p>
<p>2)<strong>SqlSessionFactoryBuilder</strong> : 创建SqlSessionFactory对象，<br>     SqlSessionFactoryBuilder builder  = new SqlSessionFactoryBuilder();<br>    //创建SqlSessionFactory对象<br>    SqlSessionFactory factory = builder.build(in);</p>
<p>  3）<strong>SqlSessionFactory</strong> ： 重量级对象， 程序创建一个对象耗时比较长，使用资源比较多。<br>        在整个项目中，有一个就够用了。</p>
<p> SqlSessionFactory:接口  ， 接口实现类： DefaultSqlSessionFactory<br>  SqlSessionFactory作用： 获取SqlSession对象。SqlSession sqlSession = factory.openSession();</p>
<p>  <strong>openSession()方法说明：</strong></p>
<ol>
<li><p><strong>openSession() ：</strong>无参数的， 获取是非自动提交事务的SqlSession对象</p>
</li>
<li><p><strong>openSession(boolean):</strong> openSession(true)  获取自动提交事务的SqlSession. </p>
<pre><code>                             openSession(false)  非自动提交事务的SqlSession对象
</code></pre>
</li>
</ol>
<p>4)<strong>SqlSession:</strong><br>   SqlSession接口 ：定义了操作数据的方法 例如 selectOne() ,selectList() ,insert(),update(), delete(), commit(), rollback()<br>   SqlSession接口的实现类DefaultSqlSession。</p>
<p>使用要求： SqlSession对象不是线程安全的，需要在方法内部使用， 在执行sql语句之前，使用openSession()获取SqlSession对象。<br>在执行完sql语句后，需要关闭它，执行SqlSession.close(). 这样能保证他的使用是线程安全的。</p>
<h1 id="三、工具类"><a href="#三、工具类" class="headerlink" title="三、工具类"></a>三、工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String config = <span class="string">&quot;mybatis.xml&quot;</span>;</span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(config);</span><br><span class="line">            factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (factory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sqlSession = factory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、动态代理"><a href="#四、动态代理" class="headerlink" title="四、动态代理"></a>四、动态代理</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectStudents</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       List&lt;Student&gt; students = dao.selectStudents();</span><br><span class="line">       <span class="keyword">for</span> (Student student : students) &#123;</span><br><span class="line">           System.out.println(student);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">selectStudentById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;dao.StudentDao&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">        select * from student where id=#&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>传入参数： 从java代码中把数据传入到mapper文件的sql语句中。</strong><br>  1）parameterType ： 写在mapper文件中的 一个属性。 表示dao接口中方法的参数的数据类型。</p>
<pre><code>  例如StudentDao接口
   public Student  selectStudentById(Integer id) 
</code></pre>
<ol start="2">
<li>一个简单类型的参数：<br>简单类型： mybatis把java的基本数据类型和String都叫简单类型。<br>在mapper文件获取简单类型的一个参数的值，使用 #{任意字符}</li>
</ol>
<p>   接口：public Student  selectStudentById(Integer id)<br>   mapper:select id,name, email,age from student where id=#{studentId}</p>
</li>
</ol>
<p>3.使用#{}之后， mybatis执行sql是使用的jdbc中的PreparedStatement对象<br>        由mybatis执行下面的代码：<br>         1. mybatis创建Connection ， PreparedStatement对象<br>            String sql=”select id,name, email,age from student where id=?”;<br>            PreparedStatement pst = conn.preparedStatement(sql);<br>            pst.setInt(1,1001);</p>
<ol start="2">
<li>执行sql封装为resultType=”com.bjpowernode.domain.Student”这个对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ResultSet rs = ps.executeQuery();</span><br><span class="line">Student student = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">   <span class="comment">//从数据库取表的一行数据， 存到一个java对象属性中</span></span><br><span class="line">   student = <span class="keyword">new</span> Student();</span><br><span class="line">   student.setId(rs.getInt(<span class="string">&quot;id));</span></span><br><span class="line"><span class="string">   student.setName(rs.getString(&quot;</span>name<span class="string">&quot;));</span></span><br><span class="line"><span class="string">   student.setEmail(rs.getString(&quot;</span>email<span class="string">&quot;));</span></span><br><span class="line"><span class="string">   student.setAge(rs.getInt(&quot;</span>age<span class="string">&quot;));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">   return student;  //给了dao方法调用的返回值</span></span><br></pre></td></tr></table></figure>

4)SqlSession:<br>   SqlSession接口 ：定义了操作数据的方法 例如 selectOne() ,selectList() ,insert(),update(), delete(), commit(), rollback()<br>   SqlSession接口的实现类DefaultSqlSession。使用要求： SqlSession对象不是线程安全的，需要在方法内部使用， 在执行sql语句之前，使用openSession()获取SqlSession对象。<br>在执行完sql语句后，需要关闭它，执行SqlSession.close(). 这样能保证他的使用是线程安全的。</li>
</ol>
<ol start="3">
<li>多个参数，使用@Param命名参数<br>  接口 public List<Student> selectMulitParam(@Param(“myname”) String name, @Param(“myage”) Integer age)<br>  使用  @Param(“参数名”)  String name<br> mapper文件：<pre><code> \&lt;select&gt;
     select * from student where name=#&#123;myname&#125; or age=#&#123;myage&#125;
  \&lt;/select&gt;
</code></pre>
</Student></li>
</ol>
<h1 id="五、传参"><a href="#五、传参" class="headerlink" title="五、传参"></a>五、传参</h1><p><strong>多个参数</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectByIdAndAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       Student student = dao.selectStudentByIdAndAge(<span class="number">1001</span>, <span class="number">15</span>);</span><br><span class="line">       System.out.println(student);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">selectStudentByIdAndAge</span><span class="params">(<span class="meta">@Param(&quot;myId&quot;)</span> Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          <span class="meta">@Param(&quot;myAge&quot;)</span> Integer age)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentByIdAndAge&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select * from student where id=#&#123;myId&#125; and age=#&#123;myAge&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>类传参</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--多个参数， 使用java对象的属性值，作为参数实际值</span></span><br><span class="line"><span class="comment">       使用对象语法： #&#123;属性名,javaType=类型名称,jdbcType=数据类型&#125; 很少用。</span></span><br><span class="line"><span class="comment">                   javaType:指java中的属性数据类型。</span></span><br><span class="line"><span class="comment">                   jdbcType:在数据库中的数据类型。</span></span><br><span class="line"><span class="comment">                   例如： #&#123;paramName,javaType=java.lang.String,jdbcType=VARCHAR&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       我们使用的简化方式： #&#123;属性名&#125;  ，javaType, jdbcType的值mybatis反射能获取。不用提供</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;select id=&quot;selectMultiObject&quot; resultType=&quot;com.bjpowernode.domain.Student&quot;&gt;</span></span><br><span class="line"><span class="comment">         select id,name, email,age from student where</span></span><br><span class="line"><span class="comment">          name=#&#123;paramName,javaType=java.lang.String,jdbcType=VARCHAR&#125;</span></span><br><span class="line"><span class="comment">          or age=#&#123;paramAge,javaType=java.lang.Integer,jdbcType=INTEGER&#125;</span></span><br><span class="line"><span class="comment">   &lt;/select&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMultiObject&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">         select id,name, email,age from student where</span><br><span class="line">          name=#&#123;paramName&#125;   or age=#&#123;paramAge&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMultiStudent&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">        select id,name, email,age from student where name=#&#123;name&#125; or age=#&#123;age&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">selectMultiObject</span><span class="params">(QueryParam param)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="function">List&lt;Student&gt; <span class="title">selectMultiStudent</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectMultiObject</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       QueryParam param = <span class="keyword">new</span> QueryParam();</span><br><span class="line">       param.setParamName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">       param.setParamAge(<span class="number">28</span>);</span><br><span class="line">       List&lt;Student&gt; students = dao.selectMultiObject(param);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(Student stu: students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;学生=&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectMultiStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       Student student  = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">       List&lt;Student&gt; students = dao.selectMultiStudent(student);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(Student stu: students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;学生=&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>select id,name, email,age from student where id=#{studentId}<br> # 的结果： select id,name, email,age from student where id=? </p>
<p>   select id,name, email,age from student where id=${studentId}<br>  $ 的结果：select id,name, email,age from student where id=1001</p>
<p>  String sql=”select id,name, email,age from student where id=” + “1001”;<br>  使用的Statement对象执行sql， 效率比PreparedStatement低。</p>
<p>  $:可以替换表名或者列名， 你能确定数据是安全的。可以使用$</p>
<p><strong># 和 $区别</strong></p>
<ol>
<li>#使用 ？在sql语句中做站位的， 使用PreparedStatement执行sql，效率高</li>
<li>#能够避免sql注入，更安全。</li>
<li>$不使用占位符，是字符串连接方式，使用Statement对象执行sql，效率低</li>
<li>$有sql注入的风险，缺乏安全性。</li>
<li>$:可以替换表名或者列名</li>
</ol>
<h1 id="六、封装输出结果"><a href="#六、封装输出结果" class="headerlink" title="六、封装输出结果"></a>六、封装输出结果</h1><p>mybatis执行了sql语句，得到java对象。</p>
<p> 1）resultType结果类型， 指sql语句执行完毕后， 数据转为的java对象， java类型是任意的。<br> <strong>处理方式：</strong></p>
<p>1.mybatis执行sql语句， 然后mybatis调用类的无参数构造方法，创建对象。</p>
<p>2.mybatis把ResultSet指定列值付给同名的属性。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMultiPosition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">      	select id,name, email,age from student</span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对等的jdbc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ResultSet rs = executeQuery(&quot; select id,name, email,age from student&quot; )</span><br><span class="line">   while(rs.next())&#123;</span><br><span class="line">      Student  student = new Student();</span><br><span class="line">      student.setId(rs.getInt(&quot;id&quot;));</span><br><span class="line">      student.setName(rs.getString(&quot;name&quot;))</span><br><span class="line"> 	&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>定义自定义类型的别名</li>
</ol>
<p>1.在mybatis主配置文件中定义，使&lt;typeAlias&gt;定义别名<br>2.可以在resultType中使用自定义别名</p>
<p><strong>resultMap:结果映射， 指定列名和java对象的属性对应关系。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMapById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.util.HashMap&quot;</span>&gt;</span></span><br><span class="line">       select * from student where id = #&#123;myId&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">selectMapById</span><span class="params">(<span class="meta">@Param(&quot;myId&quot;)</span> Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectMapList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       HashMap&lt;Object, Object&gt; hashMap = (HashMap) dao.selectMapById(<span class="number">1001</span>);</span><br><span class="line">       System.out.println(hashMap);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>列名和属性名不一样</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;myStudentMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.bjpowernode.domain.MyStudent&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--列名和java属性的关系--&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;stuid&quot;</span> /&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--非主键列，使用result--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;stuname&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;stuemail&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;stuage&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--列名和属性名不一样:第一种方式--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMyStudent&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;myStudentMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select id,name, email , age from student</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;MyStudent&gt; <span class="title">selectMyStudent</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectAllStudents2</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       List&lt;MyStudent&gt; students = dao.selectMyStudent();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(MyStudent stu: students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;学生=&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--列名和属性名不一样：第二种方式</span><br><span class="line">      resultType的默认原则是 同名的列值赋值给同名的属性， 使用列别名(java对象的属性名)</span><br><span class="line">   --&gt;</span><br><span class="line">   &lt;select id=&quot;selectDiffColProperty&quot; resultType=&quot;com.bjpowernode.domain.MyStudent&quot;&gt;</span><br><span class="line">       select id as stuid ,name as stuname, email as stuemail , age stuage from student</span><br><span class="line">   &lt;/select&gt;</span><br></pre></td></tr></table></figure>



<h1 id="七、处理特殊值"><a href="#七、处理特殊值" class="headerlink" title="七、处理特殊值"></a>七、处理特殊值</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       <span class="keyword">int</span> a = dao.countStudent();</span><br><span class="line">       System.out.println(a);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;countStudent&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       select count(*) from student</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countStudent</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h1 id="八、模糊查询"><a href="#八、模糊查询" class="headerlink" title="八、模糊查询"></a>八、模糊查询</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第一种 like ， java代码指定 like的内容--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLikeOne&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select id,name,email,age from student where name like #&#123;name&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--第二种方式：在mapper文件中拼接 like的内容--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectLikeTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select id,name,email,age from student where name  like &quot;%&quot; #&#123;name&#125; &quot;%&quot;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectLikeOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//准备好like的内容</span></span><br><span class="line">       String name = <span class="string">&quot;%李%&quot;</span>;</span><br><span class="line">       List&lt;Student&gt; students = dao.selectLikeOne(name);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(Student stu: students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;#######学生=&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectLikeTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//准备好like的内容</span></span><br><span class="line">       String name = <span class="string">&quot;张&quot;</span>;</span><br><span class="line">       List&lt;Student&gt; students = dao.selectLikeTwo(name);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(Student stu: students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;*******学生=&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">       sqlSession.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="九、动态sql"><a href="#九、动态sql" class="headerlink" title="九、动态sql"></a>九、动态sql</h1><p>动态sql: sql的内容是变化的，可以根据条件获取到不同的sql语句。主要是where部分发生变化。</p>
<p> 1)&lt;if&gt;是判断条件的，<br>   语法&lt;if test=”判断java对象的属性值”&gt;<br>            部分sql语句<br>        &lt;/if&gt;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectStudentById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       Student student = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">25</span>);</span><br><span class="line">       List&lt;Student&gt; studentList = dao.selectStudentIf(student);</span><br><span class="line">       System.out.println(studentList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select * from student where</span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">           name = #&#123;name&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age &gt; 0&quot;</span>&gt;</span></span><br><span class="line">           and age &gt; #&#123;age&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">selectStudentIf</span><span class="params">(Student student)</span></span>;</span><br></pre></td></tr></table></figure>

<p>2)&lt;where&gt; 用来包含 多个&lt;if&gt;的， 当多个if有一个成立的， &lt;where&gt;会自动增加一个where关键字，<br>            并去掉 if中多余的 and ，or等。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select * from student</span><br><span class="line">       <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">               name = #&#123;name&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age &gt; 0&quot;</span>&gt;</span></span><br><span class="line">               and age &gt; #&#123;age&#125;</span><br><span class="line">           <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 3）&lt;foreach&gt; 循环java中的数组，list集合的。 主要用在sql的in语句中。<br>    学生id是 1001,1002,1003的三个学生</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student where id in (1001,1002,1003)</span><br></pre></td></tr></table></figure>

<p><strong>public List&lt;Student&gt; selectFor(List&lt;Integer&gt; idlist)</strong></p>
<p> <strong>List&lt;Integer&gt; list = new …</strong><br> <strong>list.add(1001);</strong><br> <strong>list.add(1002);</strong><br> <strong>list.add(1003);</strong></p>
<p> <strong>dao.selectFor(list)</strong></p>
<p>&lt;foreach collection=”” item=”” open=”” close=”” separator=””&gt;<br>             #{xxx}<br>    &lt;/foreach&gt;</p>
<p>collection:表示接口中的方法参数的类型， 如果是数组使用array , 如果是list集合使用list<br> item:自定义的，表示数组和集合成员的变量<br> open:循环开始是的字符<br> close:循环结束时的字符<br>separator:集合成员之间的分隔符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testForEach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">       StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">       List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       list.add(<span class="number">1001</span>);</span><br><span class="line">       list.add(<span class="number">1002</span>);</span><br><span class="line">       List&lt;Student&gt; studentList = dao.selectForEach(list);</span><br><span class="line">       System.out.println(studentList);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">selectForEach</span><span class="params">(List&lt;Integer&gt; idList)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectForEach&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select * from student where id in</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;myId&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">           #&#123;myId&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectForTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">       SqlSession sqlSession = MyBatisUtils.getSqlSession();</span><br><span class="line">       StudentDao dao  =  sqlSession.getMapper(StudentDao.class);</span><br><span class="line"></span><br><span class="line">       List&lt;Student&gt; stuList  = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       Student s1 = <span class="keyword">new</span> Student();</span><br><span class="line">       s1.setId(<span class="number">1002</span>);</span><br><span class="line">       s1.setName(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">       stuList.add(s1);</span><br><span class="line"></span><br><span class="line">       s1 = <span class="keyword">new</span> Student();</span><br><span class="line">       s1.setId(<span class="number">1005</span>);;</span><br><span class="line">       s1.setName(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">       stuList.add(s1);</span><br><span class="line"></span><br><span class="line">       List&lt;Student&gt; students = dao.selectForeachTwo(stuList);</span><br><span class="line">       <span class="keyword">for</span>(Student stu:students)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;foreach--two ===&quot;</span>+stu);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;	</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">selectForeachTwo</span><span class="params">(List&lt;Student&gt; stulist)</span></span>;	</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectForeachTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;domain.Student&quot;</span>&gt;</span></span><br><span class="line">       select * from student where id in</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;stu&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span>  <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                #&#123;stu.id&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4）sql代码片段， 就是复用一些语法<br>    步骤<br>     1.先定义&lt;sql id=”自定义名称唯一”&gt;  sql语句， 表名，字段等 &lt;/sql&gt;<br>    2.再使用， &lt;include refid=”id的值” /&gt;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义sql片段--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;studentSql&quot;</span>&gt;</span></span><br><span class="line">       select id,name, age, email from student</span><br><span class="line">   <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bjpowernode.domain.Student&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;studentSql&quot;</span> /&gt;</span></span><br><span class="line">       where id &gt; 0</span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name !=null and name !=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">          and name = #&#123;name&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age &gt; 0&quot;</span>&gt;</span></span><br><span class="line">           or age &gt; #&#123;age&#125;</span><br><span class="line">       <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="十、配置文件"><a href="#十、配置文件" class="headerlink" title="十、配置文件"></a>十、配置文件</h1><p>1.数据库的属性配置文件： 把数据库连接信息放到一个单独的文件中。 和mybatis主配置文件分开。<br>     目的是便于修改，保存，处理多个数据库的信息。</p>
<p>  1）在resources目录中定义一个属性配置文件， xxxx.properties ,例如 jdbc.properties<br>    在属性配置文件中， 定义数据，格式是 key=value<br>      key： 一般使用 . 做多级目录的。<br>      例如 jdbc.mysql.driver    , jdbc.driver, mydriver<br>      jdbc.driver=com.mysql.jdbc.Driver<br>      jdbc.url=jdbc:mysql//…..<br>      jdbc.username=root<br>      jdbc.password=123456</p>
<p>  2）在mybatis的主配置文件，使用&lt;property&gt; 指定文件的位置<br>     在需要使用值的地方， ${key}</p>
<p>mapper文件，使用package指定路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> 	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span>  </span><br><span class="line"> 		<span class="comment">&lt;!--第二种方式： 使用包名</span></span><br><span class="line"><span class="comment">       name: xml文件（mapper文件）所在的包名, 这个包中所有xml文件一次都能加载给mybatis</span></span><br><span class="line"><span class="comment">       使用package的要求：</span></span><br><span class="line"><span class="comment">        1. mapper文件名称需要和接口名称一样， 区分大小写的一样</span></span><br><span class="line"><span class="comment">        2. mapper文件和dao接口需要在同一目录</span></span><br><span class="line"><span class="comment">   	--&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.bjpowernode.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="十一、分页"><a href="#十一、分页" class="headerlink" title="十一、分页"></a>十一、分页</h1><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>mybatis.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession = MyBatisUtil.getSqlSession();</span><br><span class="line">    StudentDao dao = sqlSession.getMapper(StudentDao.class);</span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">    List&lt;Student&gt; studentList = dao.selectAll();</span><br><span class="line">    System.out.println(studentList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/14/Spring%E9%9D%A2%E7%BB%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/14/Spring%E9%9D%A2%E7%BB%8F/" class="post-title-link" itemprop="url">Spring面经</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-14 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-14T00:00:00+08:00">2021-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-29 09:33:22" itemprop="dateModified" datetime="2021-05-29T09:33:22+08:00">2021-05-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-（京东）Spring的动态代理？"><a href="#1-（京东）Spring的动态代理？" class="headerlink" title="1.（京东）Spring的动态代理？"></a>1.（京东）Spring的动态代理？</h1><h1 id="2-（腾讯）AOP的实现？"><a href="#2-（腾讯）AOP的实现？" class="headerlink" title="2.（腾讯）AOP的实现？"></a>2.（腾讯）AOP的实现？</h1><h1 id="3-（京东）了解分页吗？是真正的分页吗？"><a href="#3-（京东）了解分页吗？是真正的分页吗？" class="headerlink" title="3.（京东）了解分页吗？是真正的分页吗？"></a>3.（京东）了解分页吗？是真正的分页吗？</h1><h1 id="4-（腾讯，美团）Spring-IOC、AOP"><a href="#4-（腾讯，美团）Spring-IOC、AOP" class="headerlink" title="4.（腾讯，美团）Spring IOC、AOP"></a>4.（腾讯，美团）Spring IOC、AOP</h1><h3 id="4-1-谈谈自己对于-Spring-IoC-和-AOP-的理解"><a href="#4-1-谈谈自己对于-Spring-IoC-和-AOP-的理解" class="headerlink" title="4.1 谈谈自己对于 Spring IoC 和 AOP 的理解"></a>4.1 谈谈自己对于 Spring IoC 和 AOP 的理解</h3><h4 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h4><p>IoC（Inverse of Control:控制反转）是一种<strong>设计思想</strong>，就是 <strong>将原本在程序中手动创建对象的控制权，交由Spring框架来管理。</strong> IoC 在其他语言中也有应用，并非 Spring 特有。 <strong>IoC 容器是 Spring 用来实现 IoC 的载体， IoC 容器实际上就是个Map（key，value）,Map 中存放的是各种对象。</strong></p>
<p>将对象之间的相互依赖关系交给 IoC 容器来管理，并由 IoC 容器完成对象的注入。这样可以很大程度上简化应用的开发，把应用从复杂的依赖关系中解放出来。 <strong>IoC 容器就像是一个工厂一样，当我们需要创建一个对象的时候，只需要配置好配置文件/注解即可，完全不用考虑对象是如何被创建出来的。</strong> 在实际项目中一个 Service 类可能有几百甚至上千个类作为它的底层，假如我们需要实例化这个 Service，你可能要每次都要搞清这个 Service 所有底层类的构造函数，这可能会把人逼疯。如果利用 IoC 的话，你只需要配置好，然后在需要的地方引用就行了，这大大增加了项目的可维护性且降低了开发难度。</p>
<p>Spring 时代我们一般通过 XML 文件来配置 Bean，后来开发人员觉得 XML 文件来配置不太好，于是 SpringBoot 注解配置就慢慢开始流行起来。</p>
<p>推荐阅读：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/23277575/answer/169698662">https://www.zhihu.com/question/23277575/answer/169698662</a></p>
<p><strong>Spring IoC的初始化过程：</strong></p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/f755b974ddea2dcc702d0b9b2a08710f779aff519a042e3b0340d92756835aef/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d372f537072696e67494f432545352538382539442545352541372538422545352538432539362545382542462538372545372541382538422e706e67"><img src="https://camo.githubusercontent.com/f755b974ddea2dcc702d0b9b2a08710f779aff519a042e3b0340d92756835aef/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d372f537072696e67494f432545352538382539442545352541372538422545352538432539362545382542462538372545372541382538422e706e67" alt="Spring IoC的初始化过程"></a></p>
<p>IoC源码阅读</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://javadoop.com/post/spring-ioc">https://javadoop.com/post/spring-ioc</a></li>
</ul>
<h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><p>AOP(Aspect-Oriented Programming:面向切面编程)能够将那些与业务无关，<strong>却为业务模块所共同调用的逻辑或责任（例如事务处理、日志管理、权限控制等）封装起来</strong>，便于<strong>减少系统的重复代码</strong>，<strong>降低模块间的耦合度</strong>，并<strong>有利于未来的可拓展性和可维护性</strong>。</p>
<p><strong>Spring AOP就是基于动态代理的</strong>，如果要代理的对象，实现了某个接口，那么Spring AOP会使用<strong>JDK Proxy</strong>，去创建代理对象，而对于没有实现接口的对象，就无法使用 JDK Proxy 去进行代理了，这时候Spring AOP会使用<strong>Cglib</strong> ，这时候Spring AOP会使用 <strong>Cglib</strong> 生成一个被代理对象的子类来作为代理，如下图所示：</p>
<p><a target="_blank" rel="noopener" href="https://camo.githubusercontent.com/2948f9b2b5c45eb208990afcac1bf5638783dc3ebc834d3d7d2d4f7cc050981c/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f537072696e67414f5050726f636573732e6a7067"><img src="https://camo.githubusercontent.com/2948f9b2b5c45eb208990afcac1bf5638783dc3ebc834d3d7d2d4f7cc050981c/68747470733a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f323031392d362f537072696e67414f5050726f636573732e6a7067" alt="SpringAOPProcess"></a></p>
<p>当然你也可以使用 AspectJ ,Spring AOP 已经集成了AspectJ ，AspectJ 应该算的上是 Java 生态系统中最完整的 AOP 框架了。</p>
<p>使用 AOP 之后我们可以把一些通用功能抽象出来，在需要用到的地方直接使用即可，这样大大简化了代码量。我们需要增加新功能时也方便，这样也提高了系统扩展性。日志功能、事务管理等等场景都用到了 AOP 。</p>
<h3 id="4-2-Spring-AOP-和-AspectJ-AOP-有什么区别？"><a href="#4-2-Spring-AOP-和-AspectJ-AOP-有什么区别？" class="headerlink" title="4.2 Spring AOP 和 AspectJ AOP 有什么区别？"></a>4.2 Spring AOP 和 AspectJ AOP 有什么区别？</h3><p><strong>Spring AOP 属于运行时增强，而 AspectJ 是编译时增强。</strong> Spring AOP 基于代理(Proxying)，而 AspectJ 基于字节码操作(Bytecode Manipulation)。</p>
<p>Spring AOP 已经集成了 AspectJ ，AspectJ 应该算的上是 Java 生态系统中最完整的 AOP 框架了。AspectJ 相比于 Spring AOP 功能更加强大，但是 Spring AOP 相对来说更简单，</p>
<p>如果我们的切面比较少，那么两者性能差异不大。但是，当切面太多的话，最好选择 AspectJ ，它比Spring AOP 快很多。</p>
<h1 id="5-（网易）spring管理bean的方式"><a href="#5-（网易）spring管理bean的方式" class="headerlink" title="5.（网易）spring管理bean的方式"></a>5.（网易）spring管理bean的方式</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/14/SpringMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/14/SpringMVC/" class="post-title-link" itemprop="url">SpringMVC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-14 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-14T00:00:00+08:00">2021-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-23 20:13:26" itemprop="dateModified" datetime="2021-05-23T20:13:26+08:00">2021-05-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ol>
<li>新建web maven工程</li>
<li>加入依赖<br>spring-webmvc依赖，间接把spring的依赖都加入到项目<br>jsp，servlet依赖</li>
</ol>
<p>3.重点： 在web.xml中注册springmvc框架的核心对象DispatcherServlet<br>   1)DispatcherServlet叫做中央调度器， 是一个servlet， 它的父类是继承HttpServlet<br>   2)DispatcherServlet页叫做前端控制器（front controller）<br>   3)DispatcherServlet负责接收用户提交的请求， 调用其它的控制器对象，<br>                      并把请求的处理结果显示给用户</p>
<p>4.创建一个发起请求的页面 index.jsp</p>
<p>5.创建控制器(处理器)类<br>  1）在类的上面加入@Controller注解，创建对象，并放入到springmvc容器中<br>  2）在类中的方法上面加入@RequestMapping注解。</p>
<p>6.创建一个作为结果的jsp，显示请求的处理结果。</p>
<p>7.创建springmvc的配置文件（spring的配置文件一样）<br>  1）声明组件扫描器， 指定@Contorller注解所在的包名<br>  2）声明视图解析器。帮助处理视图的。</p>
<p>pom.xml 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bjpowernode<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ch01-hello-springmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--servlet依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvc依赖--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 编码和编译和JDK版本 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    注册springmvc的核心对象DispatcherServlet</p>
<p>​    需要在tomcat服务器启动后，创建DispatcherServlet对象的实例。</p>
<p>​    为什么要创建DispatcherServlet对象的实例呢？</p>
<p>​    因为DispatcherServlet在他的创建过程中， 会同时创建springmvc容器对象，读取springmvc的配置文件，把这个配置文件中的对象都创建好， 当用户发起请求时就可以直接使用对象了。</p>
<p>​    servlet的初始化会执行init（）方法。 DispatcherServlet在init（）中{</p>
<p>​      //创建容器，读取配置文件</p>
<p>​      WebApplicationContext ctx = new ClassPathXmlApplicationContext(“springmvc.xml”);</p>
<p>​      //把容器对象放入到ServletContext中</p>
<p>​      getServletContext().setAttribute(key, ctx);</p>
<p>​    }**</p>
<p><strong>读取配置文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--自定义springmvc读取的配置文件的位置--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--springmvc的配置文件的位置的属性--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--指定自定义文件的位置--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:Springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--在tomcat启动后，创建Servlet对象</span></span><br><span class="line"><span class="comment">           load-on-startup:表示tomcat启动后创建对象的顺序。它的值是整数，数值越小，</span></span><br><span class="line"><span class="comment">                           tomcat创建对象的时间越早。 大于等于0的整数。</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           使用框架的时候， url-pattern可以使用两种值</span></span><br><span class="line"><span class="comment">           1. 使用扩展名方式， 语法 *.xxxx , xxxx是自定义的扩展名。 常用的方式 *.do, *.action, *.mvc等等</span></span><br><span class="line"><span class="comment">              不能使用 *.jsp</span></span><br><span class="line"><span class="comment">              http://localhost:8080/myweb/some.do</span></span><br><span class="line"><span class="comment">              http://localhost:8080/myweb/other.do</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">           2.使用斜杠 &quot;/&quot;</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Controller</span>:创建处理器对象，对象放在springmvc容器中。</span></span><br><span class="line"><span class="comment"> *  位置：在类的上面</span></span><br><span class="line"><span class="comment"> *  和Spring中讲的<span class="doctag">@Service</span> ,<span class="doctag">@Component</span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  能处理请求的都是控制器（处理器）： MyController能处理请求，</span></span><br><span class="line"><span class="comment"> *                         叫做后端控制器（back controller）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  没有注解之前，需要实现各种不同的接口才能做控制器使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理用户提交的请求，springmvc是使用方法来处理的</span></span><br><span class="line"><span class="comment">     * 方法是自定义的， 可以有多种返回值， 多种参数，方法名称自定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 准备使用doSome方法处理some.do请求。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestMapping</span>: 请求映射，作用是把一个请求地址和一个方法绑定在一起。</span></span><br><span class="line"><span class="comment">     *                  一个请求指定一个方法处理。</span></span><br><span class="line"><span class="comment">     *       属性： 1. value 是一个String，表示请求的uri地址的（some.do）。</span></span><br><span class="line"><span class="comment">     *                value的值必须是唯一的， 不能重复。 在使用时，推荐地址以“/”开头</span></span><br><span class="line"><span class="comment">     *       位置：1.在方法的上面，常用的。</span></span><br><span class="line"><span class="comment">     *            2.在类的上面</span></span><br><span class="line"><span class="comment">     *  说明： 使用RequestMapping修饰的方法叫做处理器方法或者控制器方法。</span></span><br><span class="line"><span class="comment">     *  使用<span class="doctag">@RequestMapping</span>修饰的方法可以处理请求的，类似Servlet中的doGet, doPost</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  返回值：ModelAndView 表示本次请求的处理结果</span></span><br><span class="line"><span class="comment">     *   Model: 数据，请求处理完成后，要显示给用户的数据</span></span><br><span class="line"><span class="comment">     *   View: 视图， 比如jsp等等。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;欢迎&quot;</span>);</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;fun&quot;</span>, <span class="string">&quot;执行dosome&quot;</span>);</span><br><span class="line">        <span class="comment">//指定视图, 指定视图的完整路径</span></span><br><span class="line">        <span class="comment">//框架对视图执行的forward操作， request.getRequestDispather(&quot;/show.jsp).forward(...)</span></span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;/show.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--声明组件扫描器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringMVC：是基于spring的一个框架， 实际上就是spring的一个模块， 专门是做web开发的。理解是servlet的一个升级</p>
<p>web开发底层是servlet ， 框架是在servlet基础上面加入一些功能，让你做web开发方便。</p>
<p>SpringMVC就是一个Spring。 Spring是容器，ioc能够管理对象，使用&lt;bean&gt;, @Component, @Repository, @Service, @Controller<br>SpringMVC能够创建对象， 放入到容器中（SpringMVC容器）， springmvc容器中放的是控制器对象，</p>
<p>我们要做的是 使用@Contorller创建控制器对象， 把对象放入到springmvc容器中， 把创建的对象作为控制器使用这个控制器对象能接收用户的请求， 显示处理结果，就当做是一个servlet使用。</p>
<p>使用@Controller注解创建的是一个普通类的对象， 不是Servlet。 springmvc赋予了控制器对象一些额外的功能。</p>
<p>web开发底层是servlet， springmvc中有一个对象是Servlet ： DispatherServlet(中央调度器)<br>DispatherServlet: 负责接收用户的所有请求， 用户把请求给了DispatherServlet， 之后DispatherServlet把请求转发给<br>                                我们的Controller对象， 最后是Controller对象处理请求。</p>
<h2 id="springmvc请求的处理流程"><a href="#springmvc请求的处理流程" class="headerlink" title="springmvc请求的处理流程"></a>springmvc请求的处理流程</h2><p> 1）发起some.do<br> 2）tomcat(web.xml–url-pattern知道 *.do的请求给DispatcherServlet)<br> 3）DispatcherServlet（根据springmvc.xml配置知道 some.do—doSome()）<br> 4）DispatcherServlet把some.do转发个MyController.doSome()方法<br> 5）框架执行doSome（）把得到ModelAndView进行处理， 转发到show.jsp</p>
<p>上面的过程简化的方式<br>  some.do—DispatcherServlet—MyController</p>
<p><img src="/2021/05/14/SpringMVC/BaiduNetdiskDownload\SpringMVC\springmvc.png" alt="springmvc"></p>
<h2 id="springmvc执行过程源代码分析"><a href="#springmvc执行过程源代码分析" class="headerlink" title="springmvc执行过程源代码分析"></a>springmvc执行过程源代码分析</h2><ol>
<li>tomcat启动，创建容器的过程<br>通过load-on-start标签指定的1，创建DisaptcherServlet对象，<br>DisaptcherServlet它的父类是继承HttpServlet的， 它是一个serlvet， 在被创建时，会执行init（）方法。<br>在init（）方法中<br>//创建容器，读取配置文件<br> WebApplicationContext ctx = new ClassPathXmlApplicationContext(“springmvc.xml”);<br> //把容器对象放入到ServletContext中<br> getServletContext().setAttribute(key, ctx);</li>
</ol>
<p>  上面创建容器作用： 创建@controller注解所在的类的对象， 创建MyController对象，<br>   这个对象放入到 springmvc的容器中， 容器是map ， 类似 map.put(“myController”,MyController对象)</p>
<p>2.请求的处理过程<br>  1）执行servlet的service()<br>       protected void service(HttpServletRequest request, HttpServletResponse response)</p>
<p>   protected void doService(HttpServletRequest request, HttpServletResponse response)</p>
<p>  DispatcherServlet.doDispatch(request, response){</p>
<p>​      调用MyController的.doSome()方法<br>  }</p>
<p>   doDispatch：springmvc中DispatcherServlet的核心方法， 所有的请求都在这个方法中完成的。</p>
<p>没有加入注解驱动标签时的状态<br>org.springframework.http.converter.ByteArrayHttpMessageConverter<br>org.springframework.http.converter.StringHttpMessageConverter<br>org.springframework.http.converter.xml.SourceHttpMessageConverter<br>org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter</p>
<p>加入注解驱动标签时的状态<br>org.springframework.http.converter.ByteArrayHttpMessageConverter<br>org.springframework.http.converter.StringHttpMessageConverter<br>org.springframework.http.converter.ResourceHttpMessageConverter<br>org.springframework.http.converter.ResourceRegionHttpMessageConverter<br>org.springframework.http.converter.xml.SourceHttpMessageConverter<br>org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter<br>org.springframework.http.converter.xml.Jaxb2RootElementHttpMessageConverter<br>org.springframework.http.converter.json.MappingJackson2HttpMessageConverter</p>
<h2 id="视图解析器"><a href="#视图解析器" class="headerlink" title="视图解析器"></a>视图解析器</h2><p>Springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--声明springmvc框架中的视图解析器--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当配置了视图解析器后，可以使用逻辑名称（文件名），指定视图</span></span><br><span class="line">      <span class="comment">//框架会使用视图解析器的前缀 + 逻辑名称 + 后缀 组成完成路径， 这里就是字符连接操作</span></span><br><span class="line">      <span class="comment">///WEB-INF/view/ + show + .jsp</span></span><br><span class="line">      mv.setViewName(<span class="string">&quot;show&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="RequestMapping"></a>RequestMapping</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	  <span class="doctag">@RequestMapping</span>:</span></span><br><span class="line"><span class="comment"> *    value ： 所有请求地址的公共部分，叫做模块名称</span></span><br><span class="line"><span class="comment"> *    位置： 放在类的上面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestMapping</span> : 请求映射</span></span><br><span class="line"><span class="comment">     *             属性： method， 表示请求的方式。 它的值RequestMethod类枚举值。</span></span><br><span class="line"><span class="comment">     *                    例如表示get请求方式， RequestMethod.GET</span></span><br><span class="line"><span class="comment">     *                    post方式， RequestMethod.POST</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  你不用get方式，错误是：</span></span><br><span class="line"><span class="comment">     *  HTTP Status 405 - Request method &#x27;GET&#x27; not supported</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//指定some.do使用get请求方式</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/some.do&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;  <span class="comment">// doGet()--service请求处理</span></span><br><span class="line">        <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">        ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;欢迎使用springmvc做web开发&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;fun&quot;</span>,<span class="string">&quot;执行的是doSome方法&quot;</span>);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//指定other.do是post请求方式</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/other.do&quot;,method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOther</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;====欢迎使用springmvc做web开发====&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;fun&quot;</span>,<span class="string">&quot;执行的是doOther方法&quot;</span>);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;other&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//不指定请求方式，没有限制</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/first.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doFirst</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">                                HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">                                HttpSession session)</span></span>&#123;</span><br><span class="line">        ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;====欢迎使用springmvc做web开发====&quot;</span> + 					request.getParameter(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        mv.addObject(<span class="string">&quot;fun&quot;</span>,<span class="string">&quot;执行的是doFirst方法&quot;</span>);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;other&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>处理器方法可以 包含以下四 类参数，这些参数会在系统调用时由系统自动赋值，即程序<br>员可在方法内直接使用。<br>➢ HttpServletRequest<br>➢ HttpServletResponse<br>➢ HttpSession<br>➢ 请求中所携带的请求参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--注册声明过滤器，解决post请求乱码的问题--&gt;</span><br><span class="line">&lt;filter&gt;</span><br><span class="line">    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</span><br><span class="line">    &lt;!--设置项目中使用的字符编码--&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;utf-8&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;!--强制请求对象（HttpServletRequest）使用encoding编码的值--&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;forceRequestEncoding&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;!--强制应答对象（HttpServletResponse）使用encoding编码的值--&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;forceResponseEncoding&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">&lt;/filter&gt;</span><br><span class="line">&lt;filter-mapping&gt;</span><br><span class="line">    &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">       /*:表示强制所有的请求先通过过滤器处理。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">&lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure>

<h2 id="逐个接收请求参数"><a href="#逐个接收请求参数" class="headerlink" title="逐个接收请求参数"></a>逐个接收请求参数</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;receivep.do&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">       name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">       age:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 逐个接收请求参数：</span></span><br><span class="line"><span class="comment">    *   要求： 处理器（控制器）方法的形参名和请求中参数名必须一致。</span></span><br><span class="line"><span class="comment">    *          同名的请求参数赋值给同名的形参</span></span><br><span class="line"><span class="comment">    * 框架接收请求参数</span></span><br><span class="line"><span class="comment">    *   1. 使用request对象接收请求参数</span></span><br><span class="line"><span class="comment">    *      String strName = request.getParameter(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">    *      String strAge = request.getParameter(&quot;age&quot;);</span></span><br><span class="line"><span class="comment">    *   2. springmvc框架通过 DispatcherServlet 调用 MyController的doSome()方法</span></span><br><span class="line"><span class="comment">    *      调用方法时，按名称对应，把接收的参数赋值给形参</span></span><br><span class="line"><span class="comment">    *      doSome（strName，Integer.valueOf(strAge)）</span></span><br><span class="line"><span class="comment">    *      框架会提供类型转换的功能，能把String转为 int ，long ， float， double等类型。</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  400状态码是客户端错误， 表示提交请求参数过程中，发生了问题。</span></span><br><span class="line"><span class="comment">    */</span>	</span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/receivep.do&quot;)</span></span><br><span class="line"><span class="comment">//包装类可以为空值</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">       ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       modelAndView.addObject(<span class="string">&quot;myname&quot;</span>, name);</span><br><span class="line">       modelAndView.addObject(<span class="string">&quot;myage&quot;</span>, age);</span><br><span class="line">       modelAndView.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> modelAndView;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>show.jsp<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>name:$&#123;myname&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>age:$&#123;myage&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 请求中参数名和处理器方法的形参名不一样</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@RequestParam</span>: 逐个接收请求参数中， 解决请求中参数名形参名不一样的问题</span></span><br><span class="line"><span class="comment">    *      属性： 1. value 请求中的参数名称</span></span><br><span class="line"><span class="comment">    *            2. required 是一个boolean，默认是true</span></span><br><span class="line"><span class="comment">    *                true：表示请求中必须包含此参数。</span></span><br><span class="line"><span class="comment">    *      位置： 在处理器方法的形参定义的前面</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/receiveparam.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">receiveParam</span><span class="params">(<span class="meta">@RequestParam(value = &quot;rname&quot;,required = false)</span> String name,</span></span></span><br><span class="line"><span class="params"><span class="function">                                    <span class="meta">@RequestParam(value = &quot;rage&quot;,required = false)</span> Integer age)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;doSome, name=&quot;</span>+name+<span class="string">&quot;   age=&quot;</span>+age);</span><br><span class="line">       <span class="comment">//可以在方法中直接使用 name ， age</span></span><br><span class="line">       <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">       ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       mv.addObject(<span class="string">&quot;myname&quot;</span>,name);</span><br><span class="line">       mv.addObject(<span class="string">&quot;myage&quot;</span>,age);</span><br><span class="line">       <span class="comment">//show是视图文件的逻辑名称（文件名称）</span></span><br><span class="line">       mv.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>post乱码解决方式</strong></p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册声明过滤器，解决post请求乱码的问题--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--设置项目中使用的字符编码--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--强制请求对象（HttpServletRequest）使用encoding编码的值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--强制应答对象（HttpServletResponse）使用encoding编码的值--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">          /*:表示强制所有的请求先通过过滤器处理。</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用java对象接收请求参数"><a href="#使用java对象接收请求参数" class="headerlink" title="使用java对象接收请求参数"></a>使用java对象接收请求参数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 属性名和请求中参数名一样</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===Student的无参数构造方法===&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>+name);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setAge&quot;</span>+age);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 处理器方法形参是java对象， 这个对象的属性名和请求中参数名一样的</span></span><br><span class="line"><span class="comment">    * 框架会创建形参的java对象， 给属性赋值。 请求中的参数是name，框架会调用setName()</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/receiveobject.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">receiveParam</span><span class="params">( Student myStudent)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;receiveParam, name=&quot;</span>+myStudent.getName()+<span class="string">&quot;   age=&quot;</span>+myStudent.getAge());</span><br><span class="line">       <span class="comment">//可以在方法中直接使用 name ， age</span></span><br><span class="line">       <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">       ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       mv.addObject(<span class="string">&quot;myname&quot;</span>,myStudent.getName());</span><br><span class="line">       mv.addObject(<span class="string">&quot;myage&quot;</span>,myStudent.getAge());</span><br><span class="line">       mv.addObject(<span class="string">&quot;mystudent&quot;</span>,myStudent);</span><br><span class="line">       <span class="comment">//show是视图文件的逻辑名称（文件名称）</span></span><br><span class="line">       mv.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>/WEB-INF/view/show.jsp从request作用域获取数据<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>myname数据：$&#123;myname&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>myage数据：$&#123;myage&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>student数据：$&#123;mystudent&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="处理器方法的返回值"><a href="#处理器方法的返回值" class="headerlink" title="处理器方法的返回值"></a>处理器方法的返回值</h2><p><strong>1.返回 Mode l AndView</strong></p>
<p><strong>2.返回 String</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 处理器方法返回String--表示逻辑视图名称，需要配置视图解析器</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/returnString-view.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">doReturnView</span><span class="params">(HttpServletRequest request,String name, Integer age)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;doReturnView, name=&quot;</span>+name+<span class="string">&quot;   age=&quot;</span>+age);</span><br><span class="line">       <span class="comment">//可以自己手工添加数据到request作用域</span></span><br><span class="line">       request.setAttribute(<span class="string">&quot;myname&quot;</span>,name);</span><br><span class="line">       request.setAttribute(<span class="string">&quot;myage&quot;</span>,age);</span><br><span class="line">       <span class="comment">// show : 逻辑视图名称，项目中配置了视图解析器</span></span><br><span class="line">       <span class="comment">// 框架对视图执行forward转发操作</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.返回</strong> <strong>void</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器方法返回void， 响应ajax请求</span></span><br><span class="line">   <span class="comment">//手工实现ajax，json数据： 代码有重复的 1. java对象转为json； 2. 通过HttpServletResponse输出json数据</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/returnVoid-ajax.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doReturnVoidAjax</span><span class="params">(HttpServletResponse response, String name, Integer age)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;===doReturnVoidAjax====, name=&quot;</span>+name+<span class="string">&quot;   age=&quot;</span>+age);</span><br><span class="line">      <span class="comment">//处理ajax， 使用json做数据的格式</span></span><br><span class="line">      <span class="comment">//service调用完成了， 使用Student表示处理结果</span></span><br><span class="line">       Student student  = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;张飞同学&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">28</span>);</span><br><span class="line"></span><br><span class="line">       String json = <span class="string">&quot;&quot;</span>;</span><br><span class="line">       <span class="comment">//把结果的对象转为json格式的数据</span></span><br><span class="line">       <span class="keyword">if</span>( student != <span class="keyword">null</span>)&#123;</span><br><span class="line">           ObjectMapper om  = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">           json  = om.writeValueAsString(student);</span><br><span class="line">           System.out.println(<span class="string">&quot;student转换的json====&quot;</span>+json);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//输出数据，响应ajax的请求</span></span><br><span class="line">       response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">       PrintWriter pw  = response.getWriter();</span><br><span class="line">       pw.println(json);</span><br><span class="line">       pw.flush();</span><br><span class="line">       pw.close();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.返回 对象 Object</strong></p>
<p>需要导入 Jackson 的相关 Jar 包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>springmvc处理器方法返回Object， 可以转为json输出到浏览器，响应ajax的<strong>内部原理</strong></p>
<ol>
<li><p><strong>&lt;mvc:annotation-driven&gt; 注解驱动。</strong><br>注解驱动实现的功能是 完成java对象到json，xml， text，二进制等数据格式的转换。<br>&lt;mvc:annotation-driven&gt;在加入到springmvc配置文件后， 会自动创建HttpMessageConverter接口的7个实现类对象， 包括 MappingJackson2HttpMessageConverter （使用jackson工具库中的ObjectMapper实现java对象转为json字符串）</p>
</li>
<li><p>HttpMessageConverter接口：消息转换器。<br>功能：定义了java转为json，xml等数据格式的方法。 这个接口有很多的实现类。这些实现类完成 java对象到json， java对象到xml，java对象到二进制数据的转换</p>
<p>下面的两个方法是控制器类把结果输出给浏览器时使用的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; var1, <span class="meta">@Nullable</span> MediaType var2)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(T var1, <span class="meta">@Nullable</span> MediaType var2, HttpOutputMessage var3)</span></span></span><br></pre></td></tr></table></figure>

<p>例如处理器方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/returnString.do&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">doReturnView2</span><span class="params">(HttpServletRequest request,String name, Integer age)</span></span>&#123;</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setName(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        student.setAge(<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1）canWrite作用检查处理器方法的返回值，能不能转为var2表示的数据格式。<br>  检查student(lisi，20)能不能转为var2表示的数据格式。如果检查能转为json，canWrite返回true<br>  MediaType：表示数格式的， 例如json， xml等等</p>
<p>2）write：把处理器方法的返回值对象，调用jackson中的ObjectMapper转为json字符串。<br>   json  = om.writeValueAsString(student);</p>
</li>
</ol>
<p>3.@ResponseBody注解<br>  放在处理器方法的上面， 通过HttpServletResponse输出数据，响应ajax请求的。<br>          PrintWriter pw  = response.getWriter();<br>          pw.println(json);<br>          pw.flush();<br>          pw.close();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 处理器方法返回一个Student，通过框架转为json，响应ajax请求</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@ResponseBody</span>:</span></span><br><span class="line"><span class="comment">    *    作用：把处理器方法返回对象转为json后，通过HttpServletResponse输出给浏览器。</span></span><br><span class="line"><span class="comment">    *    位置：方法的定义上面。 和其它注解没有顺序的关系。</span></span><br><span class="line"><span class="comment">    * 返回对象框架的处理流程：</span></span><br><span class="line"><span class="comment">    *  1. 框架会把返回Student类型，调用框架的中ArrayList&lt;HttpMessageConverter&gt;中每个类的canWrite()方法</span></span><br><span class="line"><span class="comment">    *     检查那个HttpMessageConverter接口的实现类能处理Student类型的数据--MappingJackson2HttpMessageConverter</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  2.框架会调用实现类的write（）， MappingJackson2HttpMessageConverter的write()方法</span></span><br><span class="line"><span class="comment">    *    把李四同学的student对象转为json， 调用Jackson的ObjectMapper实现转为json</span></span><br><span class="line"><span class="comment">    *    contentType: application/json;charset=utf-8</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  3.框架会调用<span class="doctag">@ResponseBody</span>把2的结果数据输出到浏览器， ajax请求处理完成</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/returnStudentJson.do&quot;)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Student <span class="title">doStudentJsonObject</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//调用service，获取请求结果数据 ， Student对象表示结果数据</span></span><br><span class="line">       Student student = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;李四同学&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">20</span>);</span><br><span class="line">       <span class="keyword">return</span> student; <span class="comment">// 会被框架转为json</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  处理器方法返回List&lt;Student&gt;</span></span><br><span class="line"><span class="comment">    * 返回对象框架的处理流程：</span></span><br><span class="line"><span class="comment">    *  1. 框架会把返回List&lt;Student&gt;类型，调用框架的中ArrayList&lt;HttpMessageConverter&gt;中每个类的canWrite()方法</span></span><br><span class="line"><span class="comment">    *     检查那个HttpMessageConverter接口的实现类能处理Student类型的数据--MappingJackson2HttpMessageConverter</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  2.框架会调用实现类的write（）， MappingJackson2HttpMessageConverter的write()方法</span></span><br><span class="line"><span class="comment">    *    把李四同学的student对象转为json， 调用Jackson的ObjectMapper实现转为json array</span></span><br><span class="line"><span class="comment">    *    contentType: application/json;charset=utf-8</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  3.框架会调用<span class="doctag">@ResponseBody</span>把2的结果数据输出到浏览器， ajax请求处理完成</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/returnStudentJsonArray.do&quot;)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">doStudentJsonObjectArray</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">       List&lt;Student&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       <span class="comment">//调用service，获取请求结果数据 ， Student对象表示结果数据</span></span><br><span class="line">       Student student = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;李四同学&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">20</span>);</span><br><span class="line">       list.add(student);</span><br><span class="line">       student = <span class="keyword">new</span> Student();</span><br><span class="line">       student.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">       student.setAge(<span class="number">28</span>);</span><br><span class="line">       list.add(student);</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 处理器方法返回的是String ， String表示数据的，不是视图。</span></span><br><span class="line"><span class="comment">    * 区分返回值String是数据，还是视图，看有没有<span class="doctag">@ResponseBody</span>注解</span></span><br><span class="line"><span class="comment">    * 如果有<span class="doctag">@ResponseBody</span>注解，返回String就是数据，反之就是视图</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * 默认使用“text/plain;charset=ISO-8859-1”作为contentType,导致中文有乱码，</span></span><br><span class="line"><span class="comment">    * 解决方案：给RequestMapping增加一个属性 produces, 使用这个属性指定新的contentType.</span></span><br><span class="line"><span class="comment">    * 返回对象框架的处理流程：</span></span><br><span class="line"><span class="comment">    *  1. 框架会把返回String类型，调用框架的中ArrayList&lt;HttpMessageConverter&gt;中每个类的canWrite()方法</span></span><br><span class="line"><span class="comment">    *     检查那个HttpMessageConverter接口的实现类能处理String类型的数据--StringHttpMessageConverter</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  2.框架会调用实现类的write（）， StringHttpMessageConverter的write()方法</span></span><br><span class="line"><span class="comment">    *    把字符按照指定的编码处理 text/plain;charset=ISO-8859-1</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *  3.框架会调用<span class="doctag">@ResponseBody</span>把2的结果数据输出到浏览器， ajax请求处理完成</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/returnStringData.do&quot;,produces = &quot;text/plain;charset=utf-8&quot;)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">doStringData</span><span class="params">(String name,Integer age)</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;Hello SpringMVC 返回对象，表示数据&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="发起的请求是由哪些服务器程序处理的"><a href="#发起的请求是由哪些服务器程序处理的" class="headerlink" title="发起的请求是由哪些服务器程序处理的"></a>发起的请求是由哪些服务器程序处理的</h2><p><a target="_blank" rel="noopener" href="http://localhost:8080/ch05_url_pattern/index.jsp">http://localhost:8080/ch05_url_pattern/index.jsp</a> ：tomcat（jsp会转为servlet）<br><a target="_blank" rel="noopener" href="http://localhost:8080/ch05_url_pattern/js/jquery-3.4.1.js">http://localhost:8080/ch05_url_pattern/js/jquery-3.4.1.js</a> ： tomcat<br><a target="_blank" rel="noopener" href="http://localhost:8080/ch05_url_pattern/images/p1.jpg">http://localhost:8080/ch05_url_pattern/images/p1.jpg</a> ： tomcat<br><a target="_blank" rel="noopener" href="http://localhost:8080/ch05_url_pattern/html/test.html%EF%BC%9A">http://localhost:8080/ch05_url_pattern/html/test.html：</a> tomcat<br><a target="_blank" rel="noopener" href="http://localhost:8080/ch05_url_pattern/some.do">http://localhost:8080/ch05_url_pattern/some.do</a> ：  DispatcherServlet（springmvc框架处理的）</p>
<p>tomcat本身能处理静态资源的访问， 像<strong>html</strong>， <strong>图片</strong>， <strong>js文件</strong>都是<strong>静态资源</strong></p>
<p>tomcat的web.xml文件有一个servlet 名称是 default ， 在服务器启动时创建的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  表示静态资源和未映射的请求都这个default处理</span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>default这个servlet作用： </p>
<p>1.处理静态资源<br>2.处理未映射到其它servlet的请求。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>myweb<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        使用框架的时候， url-pattern可以使用两种值</span></span><br><span class="line"><span class="comment">        1. 使用扩展名方式， 语法 *.xxxx , xxxx是自定义的扩展名。 常用的方式 *.do, *.action, *.mvc等等</span></span><br><span class="line"><span class="comment">           不能使用 *.jsp</span></span><br><span class="line"><span class="comment">           http://localhost:8080/myweb/some.do</span></span><br><span class="line"><span class="comment">           http://localhost:8080/myweb/other.do</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        2.使用斜杠 &quot;/&quot;</span></span><br><span class="line"><span class="comment">          当你的项目中使用了  / ，它会替代 tomcat中的default。</span></span><br><span class="line"><span class="comment">          导致所有的静态资源都给DispatcherServlet处理， 默认情况下DispatcherServlet没有处理静态资源的能力。</span></span><br><span class="line"><span class="comment">          没有控制器对象能处理静态资源的访问。所以静态资源（html，js，图片，css）都是404.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          动态资源some.do是可以访问，的因为我们程序中有MyController控制器对象，能处理some.do请求。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="处理静态资源的方法"><a href="#处理静态资源的方法" class="headerlink" title="处理静态资源的方法"></a>处理静态资源的方法</h2><p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第一种处理静态资源的方式：</span></span><br><span class="line"><span class="comment">    需要在springmvc配置文件加入 &lt;mvc:default-servlet-handler&gt;</span></span><br><span class="line"><span class="comment">    原理是： 加入这个标签后，框架会创健控制器对象DefaultServletHttpRequestHandler（类似我们自己创建的MyController）.</span></span><br><span class="line"><span class="comment">    DefaultServletHttpRequestHandler这个对象可以把接收的请求转发给 tomcat的default这个servlet。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第二种处理静态资源的方式</span></span><br><span class="line"><span class="comment">    mvc:resources 加入后框架会创建 ResourceHttpRequestHandler这个处理器对象。</span></span><br><span class="line"><span class="comment">    让这个对象处理静态资源的访问，不依赖tomcat服务器。</span></span><br><span class="line"><span class="comment">    mapping:访问静态资源的uri地址， 使用通配符 **</span></span><br><span class="line"><span class="comment">    location：静态资源在你的项目中的目录位置。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    images/**:表示 images/p1.jpg  , images/user/logo.gif , images/order/history/list.png</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/images/&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--mvc:resources和@RequestMapping有一定的冲突--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用一个配置语句，指定多种静态资源的访问--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--&lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/static/&quot; /&gt;--&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="路径问题"><a href="#路径问题" class="headerlink" title="路径问题"></a>路径问题</h2><p>在jsp ， html中使用的地址， 都是在前端页面中的地址，都是相对地址</p>
<p>地址分类：<br> 1.绝对地址 ， 带有协议名称的是绝对地址，  <a target="_blank" rel="noopener" href="http://www.baidu.com/">http://www.baidu.com</a> , <a href="ftp://202.122.23.1/">ftp://202.122.23.1</a><br> 2.相对地址， 没有协议开头的， 例如 user/some.do  , /user/some.do<br>              相对地址不能独立使用，必须有一个参考地址。 通过参考地址+相对地址本身才能指定资源。</p>
<p><strong>不加斜杠</strong></p>
<p>在index.jsp发起 user/some.do请求，访问地址变为 <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/user/some.do">http://localhost:8080/ch06_path/user/some.do</a></p>
<p>当你的地址 没有斜杠开头,例如 user/some.do , 当你点击链接时， 访问地址是当前页面的地址加上链接的地址。<br>      <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/">http://localhost:8080/ch06_path/</a> + user/some.do</p>
<p><strong>有斜杠</strong></p>
<p> index.jsp  访问 user/some.do  ， 返回后现在的地址： <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/user/some.do">http://localhost:8080/ch06_path/user/some.do</a></p>
<p>  <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/user/some.do">http://localhost:8080/ch06_path/user/some.do</a><br>  路径：      <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/user/">http://localhost:8080/ch06_path/user/</a><br>  资源：   some.do</p>
<p>  在index.jsp在 user/some.do ，就变为 <a target="_blank" rel="noopener" href="http://localhost:8080/ch06_path/user/user/some.do">http://localhost:8080/ch06_path/user/user/some.do</a></p>
<p>  解决方案：<br>   1.加入${pageContext.request.contextPath}<br>   2.加入一个base标签， 是html语言中的标签。 表示当前页面中访问地址的基地址。<br>      你的页面中所有 没有“/”开头的地址，都是以base标签中的地址为参考地址<br>      使用base中的地址 + user/some.do 组成访问地址</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    String basePath = request.getScheme() + <span class="string">&quot;://&quot;</span> +</span><br><span class="line">            request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() +</span><br><span class="line">            request.getContextPath() + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span> /&gt;</span><br><span class="line">	&lt;/head&gt;</span><br></pre></td></tr></table></figure>

<h2 id="请求重定向和转发"><a href="#请求重定向和转发" class="headerlink" title="请求重定向和转发"></a>请求重定向和转发</h2><p>当处理器对请求处理完毕后，向其它资源进行跳转时，有两种跳转方式：请求转发与重定向。而根据所要跳转的资源类型，又可分为两类：跳转到页面与跳转到其它处理器。注意，对于请求转发的页面，可以是WEB INF 中页面；而重定向的页面，是不能为 WEB INF<br>中页的。因为重定向相当于用户再次发出一次请求，而用户是不能直接访问 WEB INF 中资源的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理器方法返回ModelAndView,实现转发forward</span></span><br><span class="line"><span class="comment"> * 语法： setViewName(&quot;forward:视图文件完整路径&quot;)</span></span><br><span class="line"><span class="comment"> * forward特点： 不和视图解析器一同使用，就当项目中没有视图解析器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/doForward.do&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">    ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;欢迎使用springmvc做web开发&quot;</span>);</span><br><span class="line">    mv.addObject(<span class="string">&quot;fun&quot;</span>,<span class="string">&quot;执行的是doSome方法&quot;</span>);</span><br><span class="line">    <span class="comment">//显示转发</span></span><br><span class="line">    <span class="comment">//mv.setViewName(&quot;forward:/WEB-INF/view/show.jsp&quot;);</span></span><br><span class="line"></span><br><span class="line">    mv.setViewName(<span class="string">&quot;forward:/hello.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 处理器方法返回ModelAndView,实现重定向redirect</span></span><br><span class="line"><span class="comment">    * 语法：setViewName(&quot;redirect:视图完整路径&quot;)</span></span><br><span class="line"><span class="comment">    * redirect特点： 不和视图解析器一同使用，就当项目中没有视图解析器</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * 框架对重定向的操作：</span></span><br><span class="line"><span class="comment">    * 1.框架会把Model中的简单类型的数据，转为string使用，作为hello.jsp的get请求参数使用。</span></span><br><span class="line"><span class="comment">    *   目的是在 doRedirect.do 和 hello.jsp 两次请求之间传递数据</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * 2.在目标hello.jsp页面可以使用参数集合对象 $&#123;param&#125;获取请求参数值</span></span><br><span class="line"><span class="comment">    *    $&#123;param.myname&#125;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * 3.重定向不能访问/WEB-INF资源</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@RequestMapping(value = &quot;/doRedirect.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doWithRedirect</span><span class="params">(String name,Integer age)</span></span>&#123;</span><br><span class="line">       <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">       ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">       <span class="comment">//数据放入到 request作用域</span></span><br><span class="line">       mv.addObject(<span class="string">&quot;myname&quot;</span>,name);</span><br><span class="line">       mv.addObject(<span class="string">&quot;myage&quot;</span>,age);</span><br><span class="line">       <span class="comment">//重定向</span></span><br><span class="line">       mv.setViewName(<span class="string">&quot;redirect:/hello.jsp&quot;</span>);</span><br><span class="line">       <span class="comment">//http://localhost:8080/ch08_forard_redirect/hello.jsp?myname=lisi&amp;myage=22</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//重定向不能访问/WEB-INF资源</span></span><br><span class="line">       <span class="comment">//mv.setViewName(&quot;redirect:/WEB-INF/view/show.jsp&quot;);</span></span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>异常处理步骤：<br>1.新建maven web项目<br>2.加入依赖<br>3.新建一个自定义异常类 MyUserException , 再定义它的子类NameException ,AgeException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUserException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUserException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUserException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表示当用户的姓名有异常，抛出NameException</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameException</span> <span class="keyword">extends</span> <span class="title">MyUserException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NameException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NameException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当年龄有问题时，抛出的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AgeException</span> <span class="keyword">extends</span> <span class="title">MyUserException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AgeException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AgeException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.在controller抛出NameException , AgeException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">(String name,Integer age)</span> <span class="keyword">throws</span> MyUserException </span>&#123;</span><br><span class="line">       <span class="comment">//处理some.do请求了。 相当于service调用处理完成了。</span></span><br><span class="line">       ModelAndView mv  = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//try &#123;</span></span><br><span class="line">           <span class="comment">//根据请求参数抛出异常</span></span><br><span class="line">           <span class="keyword">if</span> (!<span class="string">&quot;zs&quot;</span>.equals(name)) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> NameException(<span class="string">&quot;姓名不正确！！！&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (age == <span class="keyword">null</span> || age &gt; <span class="number">80</span>) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> AgeException(<span class="string">&quot;年龄比较大！！！&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//&#125;catch(Exception e)&#123;</span></span><br><span class="line">       <span class="comment">//   e.printStackTrace();</span></span><br><span class="line">       <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">       mv.addObject(<span class="string">&quot;myname&quot;</span>,name);</span><br><span class="line">       mv.addObject(<span class="string">&quot;myage&quot;</span>,age);</span><br><span class="line">       mv.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> mv;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>5.创建一个普通类，作用全局异常处理类<br>  1）在类的上面加入@ControllerAdvice<br>  2) 在类中定义方法，方法的上面加入@ExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ControllerAdvice</span> : 控制器增强（也就是说给控制器类增加功能--异常处理功能）</span></span><br><span class="line"><span class="comment"> *           位置：在类的上面。</span></span><br><span class="line"><span class="comment"> *  特点：必须让框架知道这个注解所在的包名，需要在springmvc配置文件声明组件扫描器。</span></span><br><span class="line"><span class="comment"> *  指定<span class="doctag">@ControllerAdvice</span>所在的包名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义方法，处理发生的异常</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        处理异常的方法和控制器方法的定义一样， 可以有多个参数，可以有ModelAndView,</span></span><br><span class="line"><span class="comment">        String, void,对象类型的返回值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        形参：Exception，表示Controller中抛出的异常对象。</span></span><br><span class="line"><span class="comment">        通过形参可以获取发生的异常信息。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        @ExceptionHandler(异常的class)：表示异常的类型，当发生此类型异常时，</span></span><br><span class="line"><span class="comment">        由当前方法处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = NameException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doNameException</span><span class="params">(Exception exception)</span></span>&#123;</span><br><span class="line">        <span class="comment">//处理NameException的异常。</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           异常发生处理逻辑：</span></span><br><span class="line"><span class="comment">           1.需要把异常记录下来， 记录到数据库，日志文件。</span></span><br><span class="line"><span class="comment">             记录日志发生的时间，哪个方法发生的，异常错误内容。</span></span><br><span class="line"><span class="comment">           2.发送通知，把异常的信息通过邮件，短信，微信发送给相关人员。</span></span><br><span class="line"><span class="comment">           3.给用户友好的提示。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;姓名必须是zs，其它用户不能访问&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;ex&quot;</span>,exception);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;nameError&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理AgeException</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = AgeException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doAgeException</span><span class="params">(Exception exception)</span></span>&#123;</span><br><span class="line">        <span class="comment">//处理AgeException的异常。</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           异常发生处理逻辑：</span></span><br><span class="line"><span class="comment">           1.需要把异常记录下来， 记录到数据库，日志文件。</span></span><br><span class="line"><span class="comment">             记录日志发生的时间，哪个方法发生的，异常错误内容。</span></span><br><span class="line"><span class="comment">           2.发送通知，把异常的信息通过邮件，短信，微信发送给相关人员。</span></span><br><span class="line"><span class="comment">           3.给用户友好的提示。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;你的年龄不能大于80&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;ex&quot;</span>,exception);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;ageError&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理其它异常， NameException, AgeException以外，不知类型的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOtherException</span><span class="params">(Exception exception)</span></span>&#123;</span><br><span class="line">        <span class="comment">//处理其它异常</span></span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;你的年龄不能大于80&quot;</span>);</span><br><span class="line">        mv.addObject(<span class="string">&quot;ex&quot;</span>,exception);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;defaultError&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.创建处理异常的视图页面<br>7.创建springmvc的配置文件<br> 1）组件扫描器 ，扫描@Controller注解<br> 2）组件扫描器，扫描@ControllerAdvice所在的包名<br> 3）声明注解驱动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--处理需要的两步--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.bjpowernode.handler&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>拦截器：<br>1）拦截器是springmvc中的一种，需要实现HandlerInterceptor接口。<br>2）拦截器和过滤器类似，功能方向侧重点不同。 过滤器是用来过滤器请求参数，设置编码字符集等工作。<br>    拦截器是拦截用户的请求，做请求做判断处理的。<br>3）拦截器是全局的，可以对多个Controller做拦截。<br>   一个项目中可以有0个或多个拦截器， 他们在一起拦截用户的请求。<br>    拦截器常用在：用户登录处理，权限检查， 记录日志。</p>
<p><strong>拦截器的执行时间：</strong><br>  1）在请求处理之前， 也就是controller类中的方法执行之前先被拦截。<br>  2）在控制器方法执行之后也会执行拦截器。<br>  3）在请求处理完成后也会执行拦截器。</p>
<p><strong>拦截器步骤：</strong><br>1.新建maven web项目<br>2.加入依赖<br>3.创建Controller类<br>4.创建一个普通类，作为拦截器使用<br>  1）实现HandlerInterceptor接口<br>  2）实现接口中的三个方法<br>5.创建show.jsp<br>6.创建springmvc的配置文件<br>  1)组件扫描器 ，扫描@Controller注解<br>  2)声明拦截器，并指定拦截的请求uri地址</p>
<p><strong>一个拦截器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拦截器类：拦截用户的请求。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> btime = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * preHandle叫做预处理方法。</span></span><br><span class="line"><span class="comment">     *   重要：是整个项目的入口，门户。 当preHandle返回true 请求可以被处理。</span></span><br><span class="line"><span class="comment">     *        preHandle返回false，请求到此方法就截止。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数：</span></span><br><span class="line"><span class="comment">     *  Object handler ： 被拦截的控制器对象</span></span><br><span class="line"><span class="comment">     * 返回值boolean</span></span><br><span class="line"><span class="comment">     *   true：请求是通过了拦截器的验证，可以执行处理器方法。</span></span><br><span class="line"><span class="comment">         *   拦截器的MyInterceptor的preHandle()</span></span><br><span class="line"><span class="comment">             =====执行MyController中的doSome方法=====</span></span><br><span class="line"><span class="comment">             拦截器的MyInterceptor的postHandle()</span></span><br><span class="line"><span class="comment">             拦截器的MyInterceptor的afterCompletion()</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">     *   false：请求没有通过拦截器的验证，请求到达拦截器就截止了。 请求没有被处理</span></span><br><span class="line"><span class="comment">     *      拦截器的MyInterceptor的preHandle()</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  特点：</span></span><br><span class="line"><span class="comment">     *   1.方法在控制器方法（MyController的doSome）之前先执行的。</span></span><br><span class="line"><span class="comment">     *     用户的请求首先到达此方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *   2.在这个 方法中可以获取请求的信息， 验证请求是否符合要求。</span></span><br><span class="line"><span class="comment">     *     可以验证用户是否登录， 验证用户是否有权限访问某个连接地址（url）。</span></span><br><span class="line"><span class="comment">     *      如果验证失败，可以截断请求，请求不能被处理。</span></span><br><span class="line"><span class="comment">     *      如果验证成功，可以放行请求，此时控制器方法才能执行。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        btime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器的MyInterceptor的preHandle()&quot;</span>);</span><br><span class="line">        <span class="comment">//计算的业务逻辑，根据计算结果，返回true或者false</span></span><br><span class="line">        <span class="comment">//给浏览器一个返回结果</span></span><br><span class="line">        <span class="comment">//request.getRequestDispatcher(&quot;/tips.jsp&quot;).forward(request,response);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       postHandle:后处理方法。</span></span><br><span class="line"><span class="comment">       参数：</span></span><br><span class="line"><span class="comment">        Object handler：被拦截的处理器对象MyController</span></span><br><span class="line"><span class="comment">        ModelAndView mv:处理器方法的返回值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        特点：</span></span><br><span class="line"><span class="comment">         1.在处理器方法之后执行的（MyController.doSome()）</span></span><br><span class="line"><span class="comment">         2.能够获取到处理器方法的返回值ModelAndView,可以修改ModelAndView中的</span></span><br><span class="line"><span class="comment">         数据和视图，可以影响到最后的执行结果。</span></span><br><span class="line"><span class="comment">         3.主要是对原来的执行结果做二次修正，</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         ModelAndView mv = MyController.doSome();</span></span><br><span class="line"><span class="comment">         postHandle(request,response,handler,mv);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">                           HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">                           Object handler, ModelAndView mv)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器的MyInterceptor的postHandle()&quot;</span>);</span><br><span class="line">        <span class="comment">//对原来的doSome执行结果，需要调整。</span></span><br><span class="line">        <span class="keyword">if</span>( mv != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//修改数据</span></span><br><span class="line">            mv.addObject(<span class="string">&quot;mydate&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">            <span class="comment">//修改视图</span></span><br><span class="line">            mv.setViewName(<span class="string">&quot;other&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      afterCompletion:最后执行的方法</span></span><br><span class="line"><span class="comment">      参数</span></span><br><span class="line"><span class="comment">        Object handler:被拦截器的处理器对象</span></span><br><span class="line"><span class="comment">        Exception ex：程序中发生的异常</span></span><br><span class="line"><span class="comment">      特点:</span></span><br><span class="line"><span class="comment">       1.在请求处理完成后执行的。框架中规定是当你的视图处理完成后，对视图执行了forward。就认为请求处理完成。</span></span><br><span class="line"><span class="comment">       2.一般做资源回收工作的， 程序请求过程中创建了一些对象，在这里可以删除，把占用的内存回收。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">                                Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器的MyInterceptor的afterCompletion()&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> etime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;计算从preHandle到请求处理完成的时间：&quot;</span>+(etime - btime ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>springmvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--声明拦截器： 拦截器可以有0或多个--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--声明第一个拦截器--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--指定拦截的请求uri地址</span></span><br><span class="line"><span class="comment">               path：就是uri地址，可以使用通配符 **</span></span><br><span class="line"><span class="comment">                     ** ： 表示任意的字符，文件或者多级目录和目录中的文件</span></span><br><span class="line"><span class="comment">               http://localhost:8080/myweb/user/listUser.do</span></span><br><span class="line"><span class="comment">               http://localhost:8080/myweb/student/addStudent.do</span></span><br><span class="line"><span class="comment">           --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--声明拦截器对象--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.bjpowernode.handler.MyInterceptor&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>多个拦截器</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--声明第一个拦截器--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--声明拦截器对象--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.bjpowernode.handler.MyInterceptor&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--声明第二个拦截器--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.bjpowernode.handler.MyInterceptor2&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.第一个拦截器preHandle=<strong>true</strong> , 第二个拦截器preHandle=<strong>true</strong> </p>
<p>111111-拦截器的MyInterceptor的preHandle()<br>22222-拦截器的MyInterceptor的preHandle()<br>=====执行MyController中的doSome方法=====<br>22222-拦截器的MyInterceptor的postHandle()<br>111111-拦截器的MyInterceptor的postHandle()<br>22222-拦截器的MyInterceptor的afterCompletion()<br>111111-拦截器的MyInterceptor的afterCompletion()</p>
<p>2.第一个拦截器preHandle=<strong>true</strong> , 第二个拦截器preHandle=<strong>false</strong></p>
<p>111111-拦截器的MyInterceptor的preHandle()<br>22222-拦截器的MyInterceptor的preHandle()<br>111111-拦截器的MyInterceptor的afterCompletion()</p>
<p>3.第一个拦截器preHandle=false , 第二个拦截器preHandle=true|false</p>
<p>111111-拦截器的MyInterceptor的preHandle()</p>
<h2 id="拦截器和过滤器的区别"><a href="#拦截器和过滤器的区别" class="headerlink" title="拦截器和过滤器的区别"></a><strong>拦截器和过滤器的区别</strong></h2><p>1.过滤器是servlet中的对象，  拦截器是框架中的对象<br>2.过滤器实现Filter接口的对象， 拦截器是实现HandlerInterceptor<br>3.过滤器是用来设置request，response的参数，属性的，侧重对数据过滤的。<br>  拦截器是用来验证请求的，能截断请求。<br>4.过滤器是在拦截器之前先执行的。<br>5.过滤器是tomcat服务器创建的对象<br>  拦截器是springmvc容器中创建的对象<br>6.过滤器是一个执行时间点。<br>  拦截器有三个执行时间点<br>7.过滤器可以处理jsp，js，html等等<br>  拦截器是侧重拦截对Controller的对象。 如果你的请求不能被DispatcherServlet接收， 这个请求不会执行拦截器内容<br>8.拦截器拦截普通类方法执行，过滤器过滤servlet请求响应</p>
<h2 id="使用拦截器检查登录的用户是不是能访问系统"><a href="#使用拦截器检查登录的用户是不是能访问系统" class="headerlink" title="使用拦截器检查登录的用户是不是能访问系统"></a>使用拦截器检查登录的用户是不是能访问系统</h2><p>实现步骤：<br>1.新建maven<br>2.修改web.xml注册中央调度器<br>3.新建index.jsp发起请求<br>4.创建MyController处理请求<br>5.创建结果show.jsp<br>6.创建一个login.jsp，模拟登录（把用户的信息放入到session）；<br>  创建一个jsp， logout.jsp,模拟退出系统（从session中删除数据）<br>7.创建拦截器，从session中获取用户的登录数据，验证能否访问系统<br>8.创建一个验证的jsp，如果验证视图，给出提示<br>9.创建springmvc配置文件<br>  声明组件扫描器<br>  声明拦截器</p>
<h2 id="SpringMVC流程"><a href="#SpringMVC流程" class="headerlink" title="SpringMVC流程"></a>SpringMVC流程</h2><p><img src="/2021/05/14/SpringMVC/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210523201038426.png" alt="image-20210523201038426"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/11/%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/11/%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">线程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-11 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-11T00:00:00+08:00">2021-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-20 15:23:58" itemprop="dateModified" datetime="2021-05-20T15:23:58+08:00">2021-05-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h1><h2 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1.基本使用"></a>1.基本使用</h2><p>（1）进程创建一个主线程，主线程再创建一个子线程，哪个线程结束哪个线程消亡，而且即使主线程消亡了，由它产生的子线程也不会消亡（子线程也可以再开子线程），直到所有线程结束，进程结束</p>
<p>（2）为什么不直接调用run方法，而是调用start方法？</p>
<p>如果直接调用run方法就是主线程调用了run方法，必须要把run方法执行完毕以后才可以继续下面的代码，并没有启动一个线程，不是真正的多线程。</p>
<p>（3）start方法调用start0方法，start0方法是JVM调用的本地方法。真正实现多线程的效果，是start0方法。调用start0之后该线程并不一定马上执行，只是将线程变成了可运行状态，具体什么时候执行，取决于CPU，由CPU统一调度</p>
<p>（4）通过runnable接口实现的线程类，不能调用start方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 创建Thread对象，把dog对象（实现Runnable），方式Thread</span></span><br><span class="line"><span class="comment">         * 此处使用了代理模式</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(dog);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;汪汪叫&quot;</span> + ++(count) + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">10</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-常用方法"><a href="#2-常用方法" class="headerlink" title="2.常用方法"></a>2.常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The minimum priority that a thread can have.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MIN_PRIORITY = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The default priority that is assigned to a thread.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NORM_PRIORITY = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The maximum priority that a thread can have.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_PRIORITY = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>1.setName</p>
<p>2.getName</p>
<p>3.start</p>
<p>4.run</p>
<p>*start底层会创建新线程，调用run，run就是一个简单的方法调用，不会启动新线程</p>
<p>5.setPriority</p>
<p>6.getPriority</p>
<p>7.sleep<br>*静态方法，使当前线程休眠</p>
<p>8.interrupt<br>*中断线程，但并没有真正的结束线程，所以一般用于中断在休眠的线程</p>
<p>9.yield：线程的礼让，让出cpu，让其他线程执行，但礼让的时间不确定，也不一定成功</p>
<p>10.join：线程的插队，插队的线程一旦插队成功，则肯定先执行完插入的线程的所有的任务</p>
<h2 id="3-用户线程和守护线程"><a href="#3-用户线程和守护线程" class="headerlink" title="3.用户线程和守护线程"></a>3.用户线程和守护线程</h2><p>1.用户线程：当线程的任务执行完或通知方式结束<br>2.守护线程：一般是为工作线程服务的，当所有的用户线程结束，守护线程自动结束<br>3.常见的守护线程：垃圾回收机制</p>
<h2 id="4-线程的生命周期"><a href="#4-线程的生命周期" class="headerlink" title="4.线程的生命周期"></a>4.线程的生命周期</h2><p>1.NEW（start后被线程调度变为Runnable）</p>
<p>2.Runnable（分为Ready和Running，Ready在线程被挂起或者线程被调度器选中执行时变为Running，在Thread.yield后变为Ready）</p>
<p>3.TimedWaiting（sleep方法，wait(time)方法，join(time)方法，LockSupport.parkNanos()方法，LockSupport.parkUntil()方法转化为TimedWaiting，时间结束转化为Runnable）</p>
<p>4.Waiting（wait方法，join方法，LockSupport.park方法转化为Waiting，notify方法，notifyAll方法，LockSupport.unpark方法转为Runnable）</p>
<p>5.Blocked（等待同步代码块的锁，获取锁后变为Runnable）</p>
<p>6.Terminate</p>
<h2 id="5-Synchronized"><a href="#5-Synchronized" class="headerlink" title="5.Synchronized"></a>5.Synchronized</h2><p>1.线程同步机制</p>
<p>（1）在多线程编程，一些敏感数据不允许被多个线程同时访问，此时就是用同步访问计数，保证数据在任何同一时刻，最多有一个线程访问，以保证数据的完整性。线程同步，当有一个线程在堆内存进行操作时，其他线程都不可以对这个内存地址进行操作，直到该线程完成操作。</p>
<p>2.具体方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (对象) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要被同步的代码，此时锁在this对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m</span> <span class="params">(Stirng name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要被同步的代码，此时锁在this对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">n</span> <span class="params">(Stirng name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要被同步的代码，此时锁在类对象xxxx.class</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">n2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (xxx.class) &#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">    	 * 需要被同步的代码，此时锁在类对象xxxx.class</span></span><br><span class="line"><span class="comment">    	 */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*锁的对象必须是同一个</p>
<h2 id="6-线程死锁"><a href="#6-线程死锁" class="headerlink" title="6.线程死锁"></a>6.线程死锁</h2><p>多个线程占用了对方的锁资源，不肯相让，导致死锁</p>
<h2 id="7-释放锁"><a href="#7-释放锁" class="headerlink" title="7.释放锁"></a>7.释放锁</h2><p>释放锁的四种情况</p>
<p>1.当前线程的同步方法，同步代码块执行结束</p>
<p>2.当前线程在同步代码块，同步方法中遇到return，break</p>
<p>3.当前线程在同步代码块，同步方法中出现了未处理的Error或Exception，导致异常结束</p>
<p>4.当前线程在同步代码块，同步方法中执行了线程对象的wait方法，当前线程暂停，并释放锁</p>
<p>不会释放的情况</p>
<p>1.线程执行同步代码块或同步方法时，程序调用Thread.sleep，Thread.yield方法暂停了当前线程的执行，不会释放锁</p>
<p>2.线程执行同步代码块，其他线程调用了该线程的suspend方法讲台线程挂起，该线程不会释放锁（不在推荐使用）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/09/%E5%8F%8D%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/09/%E5%8F%8D%E5%B0%84/" class="post-title-link" itemprop="url">反射</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-09 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-09T00:00:00+08:00">2021-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-20 15:25:43" itemprop="dateModified" datetime="2021-05-20T15:25:43+08:00">2021-05-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id><a href="#" class="headerlink" title></a><font color="darkblue"></font></h1><h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><h2 id="（一）入门"><a href="#（一）入门" class="headerlink" title="（一）入门"></a><font color="blue">（一）入门</font></h2><p>​    I）加载类，返回Class类的类型的对象clazz<br>​    II）通过clazz得到加载的类Cat的对象实例<br>​    III）通过clazz得到你加载的类Cat的method“meow”的方法对象<br>​            *即在反射中可以把方法视为对象<br>​    IV）通过method调用方法：通过方法对象来调用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(<span class="string">&quot;ReflectionTest.Cat&quot;</span>);</span><br><span class="line">      Object object = clazz.newInstance();</span><br><span class="line">      Method method = clazz.getMethod(<span class="string">&quot;meow&quot;</span>);</span><br><span class="line">      method.invoke(object);</span><br></pre></td></tr></table></figure>

<h2 id="（二）功能"><a href="#（二）功能" class="headerlink" title="（二）功能"></a><font color="blue">（二）功能</font></h2><p>​    I）在运行时判断任意一个对象所属的类<br>​    II）在运行时构建任意一个类的对象<br>​    III）在运行时得到任意一个类所具有的成员变量和方法<br>​    IV）在运行时调用任意一个对象的成员变量和方法<br>​    V）生成动态代理</p>
<h2 id="（三）相关类"><a href="#（三）相关类" class="headerlink" title="（三）相关类"></a><font color="blue">（三）相关类</font></h2><p>​    I）java.lang.Class：代表一个类，Class对象表示某个类加载后在堆中的对象<br>​    II）java.lang.reflect.Method：代表类的方法，Method对象表示某个类的方法<br>​    III）java.lang.reflect.Field：代表类的成员变量，Field对象表示某个类的成员变量</p>
<p>​        Field得到name字段（不能得到私有的成员变量）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Field nameField = clazz.getField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">      System.out.println(nameField.get(object));</span><br></pre></td></tr></table></figure>

<p>​    IV）java.lang.reflect.Constructor：代表类的构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ()中可以指定构造器参数类型，空则返回无参构造器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Constructor constructor = clazz.getConstructor();</span><br><span class="line">Constructor constructor1 = clazz.getConstructor(String.class);</span><br></pre></td></tr></table></figure>

<h2 id="（四）反射调用优化"><a href="#（四）反射调用优化" class="headerlink" title="（四）反射调用优化"></a><font color="blue">（四）反射调用优化</font></h2><p>​    I）取消在反射调用方法时，调用访问检测</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method.setAccessible(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<h2 id="（五）Class类"><a href="#（五）Class类" class="headerlink" title="（五）Class类"></a><font color="blue">（五）Class类</font></h2><h3 id="1-特性"><a href="#1-特性" class="headerlink" title="1.特性"></a><font color="green">1.特性</font></h3><p>​    *Class类对象不是new出来的，而是系统创建的<br>​    *通过类加载器ClassLoader的loadClass()创建某个类对应的Class类对象（传统new对象和反射方式都是）<br>​    *对于某个类的Class对象，在内存中只有一份，因为类只加载一次<br>​    *每个类的实例都会记得自己是由哪个Class实例所生成的<br>​    *通过Class对象可以完整的得到一个类的数据结构，通过一系列API</p>
<h3 id="2-常用方法"><a href="#2-常用方法" class="headerlink" title="2.常用方法"></a><font color="green">2.常用方法</font></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">String classAllPath = <span class="string">&quot;ReflectionTest.Car&quot;</span>;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获得Car类对应的Class对象</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class clazz = Class.forName(classAllPath);</span><br><span class="line">      System.out.println(clazz);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 得到包名</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      System.out.println(clazz.getPackage().getName());</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获得全类名</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      System.out.println(clazz.getName());</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过clazz创建对象实例</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Car car = (Car)clazz.newInstance();</span><br><span class="line">      System.out.println(car);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获得属性</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field brand = clazz.getField(<span class="string">&quot;brand&quot;</span>);</span><br><span class="line">      System.out.println(brand);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 给属性赋值</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      brand.set(car, <span class="string">&quot;benz&quot;</span>);</span><br><span class="line">      System.out.println(car);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获得所有的属性</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field[] fields = clazz.getFields();</span><br><span class="line">      <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">          System.out.println(field.getName());</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-获取Class对象的六种方式"><a href="#3-获取Class对象的六种方式" class="headerlink" title="3.获取Class对象的六种方式"></a><font color="green">3.获取Class对象的六种方式</font></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Class.forName()（多用于配置文件，读取类全路径，加载类）</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      String classAllPath = <span class="string">&quot;ReflectionTest.Car&quot;</span>;</span><br><span class="line">      Class clazz1 = Class.forName(classAllPath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 类名.class（多用于参数传递）</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class clazz2 = Car.class;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 对象.getClass()（有对象实例）</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Car car = <span class="keyword">new</span> Car();</span><br><span class="line">      Class clazz3 = car.getClass();</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过类加载器获得类的Class对象</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      ClassLoader classLoader = car.getClass().getClassLoader();</span><br><span class="line">      Class clazz4 = classLoader.loadClass(classAllPath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * clazz 1-4都是一个</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 基本数据类型</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class&lt;Integer&gt; intClass = <span class="keyword">int</span>.class;</span><br><span class="line">      Class&lt;Character&gt; charClass = <span class="keyword">char</span>.class;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 包装类</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class&lt;Integer&gt; integerClass = Integer.TYPE;</span><br><span class="line">      Class&lt;Float&gt; floatClass = Float.TYPE; </span><br></pre></td></tr></table></figure>

<h3 id="4-哪些类型有Class对象"><a href="#4-哪些类型有Class对象" class="headerlink" title="4.哪些类型有Class对象"></a><font color="green">4.哪些类型有Class对象</font></h3><p>​    I）外部类，静态内部类，成员内部类，局部内部类，匿名内部类<br>​    II）接口<br>​    III）数组<br>​    IV）二维数组<br>​    V）注解<br>​    VI）枚举<br>​    VII）void</p>
<h3 id="5-类加载"><a href="#5-类加载" class="headerlink" title="5.类加载"></a><font color="green">5.类加载</font></h3><p>​    I）静态加载：编译时加载相关的类，如果没有则报错，依赖性太强<br>​    II）动态加载：运行时加载需要的类，如果运行时不用该类，即使不存在也不报错，降低依赖性<br>​    III）三个阶段<br>​        a）加载（将类的class文件读入内存，并为之创建一个java.lang.Class对象，此过程由类加载器完成）<br>​        b）连接（将类的二进制数据合并到JRE中）：验证（文件安全性校验）、准备（静态变量默认初始化并分配空间）、解析（把符号引用转为字节引用）<br>​        c）初始化（JVM负责 对类进行初始化，这里主要是指静态成员）</p>
<h4 id="1-加载阶段"><a href="#1-加载阶段" class="headerlink" title="1.加载阶段"></a><font color="purple">1.加载阶段</font></h4><p>​        JVM在该阶段的主要目的是将字节码从不同的数据源（可能是class文件，jar包，甚至网络）转化为二进制字节流加载到内存中，并生成一个代表该类的java.lang.Class对象</p>
<h4 id="2-连接阶段-准备"><a href="#2-连接阶段-准备" class="headerlink" title="2.连接阶段-准备"></a><font color="purple">2.连接阶段-准备</font></h4><p>​        JVM会在该阶段对**<font color="red">静态变量</font>**，分配内存并初始化（对应数据类型的默认初始值，如0，0L，null，false等），这些变量所使用的内存都将在方法区中进行分配。常量直接赋值。</p>
<h4 id="3-连接阶段-验证"><a href="#3-连接阶段-验证" class="headerlink" title="3.连接阶段-验证"></a><font color="purple">3.连接阶段-验证</font></h4><p>​        目的是为了确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。包括：文件格式验证，元数据验证，字节码验证和符号引用验证。</p>
<h4 id="4-连接阶段-解析"><a href="#4-连接阶段-解析" class="headerlink" title="4.连接阶段-解析"></a><font color="purple">4.连接阶段-解析</font></h4><p>​        虚拟机将常量池内的符号引用替换为直接引用的过程。</p>
<h4 id="5-初始化"><a href="#5-初始化" class="headerlink" title="5.初始化"></a><font color="purple">5.初始化</font></h4><p>​        到初始化阶段，才真正开始执行类中定义的Java程序代码，此阶段是执行&lt;clinit&gt;()方法的过程。&lt;clinit&gt;()方法是由编译器按语句在源文件中出现顺序，依次自动收集类中的所有静态变量的复制动作和静态代码块中的语句，并进行合并。虚拟机会保证一个类的&lt;clinit&gt;()方法在多线程的环境中被正确的加锁，同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的&lt;clinit&gt;()方法，其他线程都需要阻塞等待，直到活动线程执行&lt;clinit&gt;()方法完毕<br>​        *如果直接使用类的静态属性，也会导致类的加载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (getClassLoadingLock(name))</span><br></pre></td></tr></table></figure>

<p>​        正是有了这个机制才可以保证某个类在内存中，只有一份Class对象</p>
<h2 id="（六）反射获得类的结构信息"><a href="#（六）反射获得类的结构信息" class="headerlink" title="（六）反射获得类的结构信息"></a>（六）反射获得类的结构信息</h2><h3 id="1-Class类"><a href="#1-Class类" class="headerlink" title="1.Class类"></a>1.Class类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 得到Class对象</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class personClass = Class.forName(<span class="string">&quot;ReflectionTest.Person&quot;</span>);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取全类名</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      System.out.println(personClass.getName());</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取简单类名</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      System.out.println(personClass.getSimpleName());</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取所有public修饰的属性，包含本类和父类的</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field[] fields1 = personClass.getFields();</span><br><span class="line">      <span class="keyword">for</span> (Field field : fields1) &#123;</span><br><span class="line">          System.out.println(field.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取本类中所有属性</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field[] fields2 = personClass.getDeclaredFields();</span><br><span class="line">      <span class="keyword">for</span> (Field field : fields2) &#123;</span><br><span class="line">          System.out.println(field.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取所有public修饰的方法，包含本类和父类的</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Method[] methods1 = personClass.getMethods();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取本类中所有方法</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Method[] methods2 = personClass.getDeclaredMethods();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取所有public修饰的构造器，本类</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Constructor[] constructors1 = personClass.getConstructors();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取本类中所有构造器</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Constructor[] constructors2 = personClass.getDeclaredConstructors();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Package形式返回包信息</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      personClass.getPackage();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Class形式返回父类信息</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class superClass = personClass.getSuperclass();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Class[]形式返回接口信息</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class[] interfaces = personClass.getInterfaces();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Annotation[]形式返回注解信息</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Annotation[] annotations = personClass.getAnnotations();</span><br></pre></td></tr></table></figure>

<h3 id="2-Field类"><a href="#2-Field类" class="headerlink" title="2.Field类"></a>2.Field类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以int形式返回修饰符[默认=0，public=1，private=2，protected=4，static=8，final=16] public static = 9</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class personClass = Class.forName(<span class="string">&quot;ReflectionTest.Person&quot;</span>);</span><br><span class="line">      Field[] declaredFields = personClass.getDeclaredFields();</span><br><span class="line">      <span class="keyword">for</span> (Field declaredField : declaredFields) &#123;</span><br><span class="line">          System.out.println(declaredField.getModifiers());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 以Class返回类型</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Field declaredField : declaredFields) &#123;</span><br><span class="line">          System.out.println(declaredField.getType());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 返回属性名</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Field declaredField : declaredFields) &#123;</span><br><span class="line">          System.out.println(declaredField.getName());</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Method类"><a href="#3-Method类" class="headerlink" title="3.Method类"></a>3.Method类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取本类中所有方法</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Method[] declaredMethods = personClass.getDeclaredMethods();</span><br><span class="line">      <span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">          System.out.println(declaredMethod.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取方法得访问修饰符</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">          System.out.println(declaredMethod.getModifiers());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取该方法返回类型</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">          System.out.println(declaredMethod.getReturnType());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取该方法形参类型</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">          Class[] parameterTypes = declaredMethod.getParameterTypes();</span><br><span class="line">          <span class="keyword">for</span> (Class parameterType : parameterTypes) &#123;</span><br><span class="line">              System.out.println(parameterType);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-Construtor类"><a href="#4-Construtor类" class="headerlink" title="4.Construtor类"></a>4.Construtor类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取本类所有构造器</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Constructor[] declaredConstructors = personClass.getDeclaredConstructors();</span><br><span class="line">      <span class="keyword">for</span> (Constructor declaredConstructor : declaredConstructors) &#123;</span><br><span class="line">          System.out.println(declaredConstructor.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获得该构造器得形参类型</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">for</span> (Constructor declaredConstructor : declaredConstructors) &#123;</span><br><span class="line">          Class[] classes = declaredConstructor.getParameterTypes();</span><br><span class="line">              <span class="keyword">for</span> (Class clazz : classes) &#123;</span><br><span class="line">                  System.out.println(clazz);</span><br><span class="line">              &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h2 id="（七）通过反射创建对象"><a href="#（七）通过反射创建对象" class="headerlink" title="（七）通过反射创建对象"></a>（七）通过反射创建对象</h2><p>​        1.调用类中的public修饰的无参构造器<br>​        2.调用类中的指定构造器<br>​        3.Class类相关方法<br>​            *newInstance：调用类中的无参构造器，获取对应类的对象<br>​            *getConstructor(Class…clazz)：根据参数列表，获取对应的public构造器对象<br>​            *getDeclraedConstructor(Class…clazz)：根据参数列表获取对应的构造器对象<br>​        4.Constructor类<br>​            *setAccessible：爆破,使用反射可以使用private构造器<br>​            *newInstance调用构造器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 获取User类的Class对象</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Class userClass = Class.forName(<span class="string">&quot;ReflectionTest.User&quot;</span>);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过public的无参构造器创建实例</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Object object = userClass.newInstance();</span><br><span class="line">      System.out.println(object);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过public的有参构造器创建实例</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Constructor constructor1 = userClass.getConstructor(<span class="keyword">int</span>.class);</span><br><span class="line">      Object bbb = constructor1.newInstance(<span class="number">20</span>);</span><br><span class="line">      System.out.println(bbb);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过private的有参构造器创建实例</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Constructor constructor2 = userClass.getDeclaredConstructor(<span class="keyword">int</span>.class, String.class);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 爆破</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      constructor2.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">      Object ccc = constructor2.newInstance(<span class="number">18</span>, <span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">      System.out.println(ccc);</span><br></pre></td></tr></table></figure>

<h2 id="（八）通过反射访问类中的成员"><a href="#（八）通过反射访问类中的成员" class="headerlink" title="（八）通过反射访问类中的成员"></a>（八）通过反射访问类中的成员</h2><p>​        1.根据属性名获取Field对象<br>​        2.爆破<br>​        3.访问<br>​        4.如果是静态属性，则set和get中的参数o可以写成null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Class stuClass = Class.forName(<span class="string">&quot;ReflectionTest.Student&quot;</span>);</span><br><span class="line">      Object o = stuClass.newInstance();</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过反射得到public age</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field age = stuClass.getField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">      age.set(o, <span class="number">18</span>);</span><br><span class="line">      System.out.println(o);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过反射操作private static name</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Field name = stuClass.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">      name.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 因为name是静态的</span></span><br><span class="line"><span class="comment">       * 所以还可以写成name.set(null, &quot;sb&quot;)</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      name.set(o, <span class="string">&quot;sb&quot;</span>);</span><br><span class="line">      System.out.println(o);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 得到属性，也可以get(null)</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      String oName = (String) name.get(o);</span><br><span class="line">      System.out.println(oName);</span><br></pre></td></tr></table></figure>

<h2 id="（九）通过反射访问类中方法"><a href="#（九）通过反射访问类中方法" class="headerlink" title="（九）通过反射访问类中方法"></a>（九）通过反射访问类中方法</h2><p>​        1.根据方法名和参数列表获取Method方法对象<br>​        2.获取对象<br>​        3.爆破<br>​        4.访问，如果有返回值统一返回Object，但是运行类型和返回类型相同<br>​        5.注意：如果是静态方法，则invoke的参数可以写为null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class bossClass = Class.forName(<span class="string">&quot;ReflectionTest.Boss&quot;</span>);</span><br><span class="line">      Object o = bossClass.newInstance();</span><br><span class="line">      Method method = bossClass.getMethod(<span class="string">&quot;hi&quot;</span>, String.class);</span><br><span class="line">      method.invoke(o, <span class="string">&quot;baga&quot;</span>);</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 调用private static方法</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Method say = bossClass.getDeclaredMethod(<span class="string">&quot;say&quot;</span>, <span class="keyword">int</span>.class, String.class, <span class="keyword">char</span>.class);</span><br><span class="line">      say.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">      String s = (String) say.invoke(o, <span class="number">1</span>, <span class="string">&quot;sss&quot;</span>, <span class="string">&#x27;b&#x27;</span>);</span><br><span class="line">      System.out.println(s);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.codingpupii.com/2021/05/07/Spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="pupil">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/07/Spring/" class="post-title-link" itemprop="url">Spring学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-07 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-07T00:00:00+08:00">2021-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-05-20 15:11:06" itemprop="dateModified" datetime="2021-05-20T15:11:06+08:00">2021-05-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a><font color="darkblue">Spring</font></h1><h2 id="（一）IOC"><a href="#（一）IOC" class="headerlink" title="（一）IOC"></a><font color="blue">（一）IOC</font></h2><h3 id="1-什么是IOC？"><a href="#1-什么是IOC？" class="headerlink" title="1.什么是IOC？"></a><font color="green">1.什么是IOC？</font></h3><p>​    （1）控制反转，把对象创建和对象之间的调用过程，交给Spring进行管理<br>​    （2）使用IOC的目的：降低耦合度</p>
<h3 id="2-IOC底层原理"><a href="#2-IOC底层原理" class="headerlink" title="2.IOC底层原理"></a><font color="green">2.IOC底层原理</font></h3><p>​    （1）xml解析、工厂模式、反射</p>
<h3 id="3-IOC接口"><a href="#3-IOC接口" class="headerlink" title="3.IOC接口"></a><font color="green">3.IOC接口</font></h3><p>​    （1）IOC思想基于IOC容器完成，IOC容器底层就是对象工厂</p>
<p>​    （2）Spring提供IOC容器实现两种方式：（两个接口）</p>
<p>​        1.BeanFactory：IOC容器基本实现，是Spring内部的使用接口，不提供开发人员使用<br>​        *加载配置文件时候不会创建对象，再获取对象才去创建对象<br>​        2.ApplicationContext：BeanFactory接口的子接口，提供更多更强大的功能一般由开发人员进行使用<br>​        *加载配置文件时就会把在配置文件对象进行创建</p>
<p>​    （3）ApplicationContext接口两个实现类</p>
<p>​        1.FileSystemXmlApplicationContext（用于src目录下的xml文件）</p>
<p>​        2.ClassPathXmlApplicationContext（用于盘目录下的xml文件）</p>
<h3 id="4-IOC操作Bean管理"><a href="#4-IOC操作Bean管理" class="headerlink" title="4.IOC操作Bean管理"></a><font color="green">4.IOC操作Bean管理</font></h3><p>​    （1）Bean管理指的是两个操作：Spring创建对象，Spring注入属性</p>
<p>​    （2）Bean管理方式</p>
<h5 id="1-基于xml配置文件方式实现"><a href="#1-基于xml配置文件方式实现" class="headerlink" title="1.基于xml配置文件方式实现"></a><strong>1.基于xml配置文件方式实现</strong></h5><h6 id="a）基于xml方式创建对象："><a href="#a）基于xml方式创建对象：" class="headerlink" title="a）基于xml方式创建对象："></a>a）基于xml方式创建对象：</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.User&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                在Spring配置文件中，使用bean标签，标签里面添加对应属性，就可以实现对象创建。<br>​                在bean标签有很多属性，介绍常用的属性<br>​                    <strong>*id属性**：唯一标识<br>​                    *<strong>class属性</strong>：类全路径<br>​                创建对象时，执行</strong>无参数构造**方法完成对象创建</p>
<h6 id="b）基于xml方式注入属性："><a href="#b）基于xml方式注入属性：" class="headerlink" title="b）基于xml方式注入属性："></a>b）基于xml方式注入属性：</h6><p>​                DI：依赖注入，就是注入属性<br>​                    *使用set方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.book&quot;</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baga&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                                            </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">book bok = context.getBean(<span class="string">&quot;book&quot;</span>, book.class);</span><br></pre></td></tr></table></figure>

<p>​                    *使用有参构造</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bk&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.book&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;abc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cde&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="c）xml注入其他类型属性"><a href="#c）xml注入其他类型属性" class="headerlink" title="c）xml注入其他类型属性"></a>c）xml注入其他类型属性</h6><p>​                null值：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bk&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.book&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bname&quot;</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">null</span>&gt;</span><span class="tag">&lt;/<span class="name">null</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cde&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                特殊符号：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bid&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">              &lt;![CDATA[&lt;&lt;南京&gt;&gt;]]&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="d）外部bean注入属性"><a href="#d）外部bean注入属性" class="headerlink" title="d）外部bean注入属性"></a>d）外部bean注入属性</h6><p>​                *创建两个类service类和dao类<br>​                *在service调用dao里的方法<br>​                *在Spring配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.UserService&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;useDao2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;useDao2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.UserDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="e）内部bean注入属性"><a href="#e）内部bean注入属性" class="headerlink" title="e）内部bean注入属性"></a>e）内部bean注入属性</h6><p>​                *一对多关系：部门和员工<br>​                *员工表示所属部门使用对象类型属性进行表示                        </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dept</span> </span>&#123;</span><br><span class="line">   		<span class="keyword">private</span> String dname;</span><br><span class="line"></span><br><span class="line">   		<span class="function"><span class="keyword">public</span> String <span class="title">getDname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       		<span class="keyword">return</span> dname;</span><br><span class="line">   		&#125;</span><br><span class="line"></span><br><span class="line">   		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDname</span><span class="params">(String dname)</span> </span>&#123;</span><br><span class="line">       		<span class="keyword">this</span>.dname = dname;</span><br><span class="line">   		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">   	<span class="keyword">private</span> String ename;</span><br><span class="line">  		<span class="keyword">private</span> String gender;</span><br><span class="line">   	<span class="keyword">private</span> Dept dept;</span><br><span class="line"></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDept</span><span class="params">(Dept dept)</span> </span>&#123;</span><br><span class="line">       	<span class="keyword">this</span>.dept = dept;</span><br><span class="line">   	&#125;</span><br><span class="line"></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEname</span><span class="params">(String ename)</span> </span>&#123;</span><br><span class="line">       	<span class="keyword">this</span>.ename = ename;</span><br><span class="line">   	&#125;</span><br><span class="line"></span><br><span class="line">   	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">       	<span class="keyword">this</span>.gender = gender;</span><br><span class="line">   	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                *配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Emp&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lucy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Dept&quot;</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baoan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="f）级联赋值注入属性"><a href="#f）级联赋值注入属性" class="headerlink" title="f）级联赋值注入属性"></a>f）级联赋值注入属性</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Emp&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lucy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Dept&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baoan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="g）xml注入集合属性"><a href="#g）xml注入集合属性" class="headerlink" title="g）xml注入集合属性"></a>g）xml注入集合属性</h6><p>​            *注入数组属性类型<br>​            *注入List属性类型<br>​            *注入Map属性类型</p>
<p>​                创建类，定义数组，List，Map等特殊属性，并生成set方法                </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5demo2.Stu&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cources&quot;</span> &gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>数学<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>语文<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;math&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;stringSet&quot;</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">              	<span class="tag">&lt;<span class="name">value</span>&gt;</span>oracle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="h）在集合里面设置对象类型值"><a href="#h）在集合里面设置对象类型值" class="headerlink" title="h）在集合里面设置对象类型值"></a>h）在集合里面设置对象类型值</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;courses&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;course1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;course2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;course1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5demo2.Course&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;math&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;course2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5demo2.Course&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;chinese&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="i）提取公共部分"><a href="#i）提取公共部分" class="headerlink" title="i）提取公共部分"></a>i）提取公共部分</h6><p>​                *在Spring配置文件中引入名称空间util</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">     		<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">     		<span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">     		<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                         http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">      <span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;bookList&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">value</span>&gt;</span>math<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">value</span>&gt;</span>english<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5demo2.Book&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="j）工厂Bean"><a href="#j）工厂Bean" class="headerlink" title="j）工厂Bean"></a>j）工厂Bean</h6><p>​                *Spring有两种bean，一种普通bean，一种工厂bean（FactoryBean）<br>​                *普通bean：在配置文件中定义bean类型就是返回类型<br>​                *工厂bean：在配置文件中定义bean类型可以和返回类型不一样<br>​                    i）创建类，让这个类作为工厂bean，实现接口FactoryBean<br>​                    ii）实现接口里面的方法，在实现的方法中定义返回的bean类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Course</span>&gt; </span>&#123;</span><br><span class="line">  		<span class="meta">@Override</span></span><br><span class="line">  		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  		&#125;</span><br><span class="line"></span><br><span class="line">  		<span class="meta">@Override</span></span><br><span class="line">  		<span class="function"><span class="keyword">public</span> Course <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      		Course course = <span class="keyword">new</span> Course();</span><br><span class="line">      		course.setCname(<span class="string">&quot;math&quot;</span>);</span><br><span class="line">      		<span class="keyword">return</span> course;</span><br><span class="line">  		&#125;</span><br><span class="line"></span><br><span class="line"> 			<span class="meta">@Override</span></span><br><span class="line">  		<span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">      		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;factoryBean.MyBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="k）bean作用域"><a href="#k）bean作用域" class="headerlink" title="k）bean作用域"></a>k）bean作用域</h6><p>​                I）在Spring里面，设置创建bean实例是单实例还是多实例<br>​                II）在Spring里面，默认是单实例对象，bean标签里的属性scope用于设置单实例还是多实例<br>​                III）scope属性值：默认值（singleton）多实例（protoype）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Emp&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lucy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dept&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                IV）singleton和prototype的区别<br>​                    *singleton单实例，prototype多实例<br>​                    *scope为singleton时，加载Spring配置文件时就会创建单实例对象。scope为prototype时，在调用getBean时创建多实例对                        象</p>
<h6 id="l）bean生命周期"><a href="#l）bean生命周期" class="headerlink" title="l）bean生命周期"></a>l）bean生命周期</h6><p>​                无后置处理器</p>
<p>​                I）通过构造器创建bean实例（无参构造器）<br>​                II）为bean的属性设置值和对其他bean的引用（调用set方法）<br>​                III）调用bean的初始化方法（需要进行配置）<br>​                IV）bean可以使用了（对象可以用了）<br>​                V）当容器关闭时，调用bean的销毁方法</p>
<p>​                有后置处理器</p>
<p>​                I）通过构造器创建bean实例（无参构造器）<br>​                II）为bean的属性设置值和对其他bean的引用（调用set方法）<br>​                *把bean实例传递bean后置处理器的方法<br>​                III）调用bean的初始化方法（需要进行配置）<br>​                *把bean实例传递bean后置处理器的方法<br>​                IV）bean可以使用了（对象可以用了）<br>​                V）当容器关闭时，调用bean的销毁方法</p>
<h6 id="m）后置处理器"><a href="#m）后置处理器" class="headerlink" title="m）后置处理器"></a>m）后置处理器</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybeanPost</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanPost&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5demo2.MybeanPost&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                    后置处理器会对当前配置文件中所有bean进行处理</p>
<h6 id="n）xml自动装配"><a href="#n）xml自动装配" class="headerlink" title="n）xml自动装配"></a>n）xml自动装配</h6><p>​                I）根据指定装配规则（属性名称或属性类型），Spring自动将匹配的属性值进行注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Emp&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Dept&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Emp&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">class</span>=<span class="string">&quot;Spring5.Dept&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​            o）外部属性文件</p>
<p>​                I）直接配置数据库信息                    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;druidDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/userDb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​                II）引入外部文件配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">prop.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">prop.url</span>=<span class="string">jdbc:mysql://localhost:3306/userDb</span></span><br><span class="line"><span class="meta">prop.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">prop.password</span>=<span class="string">111</span></span><br></pre></td></tr></table></figure>

<p>​                    *引入名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans 		http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;druidDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.driverClass&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;prop.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-基于注解实现"><a href="#2-基于注解实现" class="headerlink" title="2.基于注解实现"></a><strong>2.基于注解实现</strong></h5><h6 id="a）创建对象注解"><a href="#a）创建对象注解" class="headerlink" title="a）创建对象注解"></a>a）创建对象注解</h6><p>​        I）@component（普通）<br>​        II）@Service（service层和domian层）<br>​        III）@Controller（web层）<br>​        IV）@Repository（dao层）<br>​        *上面四个注解的功能是一样的</p>
<h6 id="b）基于注解创建对象"><a href="#b）基于注解创建对象" class="headerlink" title="b）基于注解创建对象"></a>b）基于注解创建对象</h6><p>​        I）开启扫描注解</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;Spring5demo3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        II）在类上注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;user2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;addddddd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="c）组件扫描配置"><a href="#c）组件扫描配置" class="headerlink" title="c）组件扫描配置"></a>c）组件扫描配置</h6><p>​        I）示例：只扫描Controller</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;Spring5demo2&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        II）示例：只不扫描Controller</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;Spring5demo2&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="d）基于注解方式实现属性注入"><a href="#d）基于注解方式实现属性注入" class="headerlink" title="d）基于注解方式实现属性注入"></a>d）基于注解方式实现属性注入</h6><p>​        I）@AutoWired（根据属性类型进行注入）</p>
<p>​            *把service和dao对象创建，在service和dao类添加创建对象注解<br>​            *在service注入dao对象，不需要set方法，添加注入属性注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>​        II）@Qualifier（根据属性名称进行注入）<br>​            *要和@Autowired一起使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   <span class="meta">@Qualifier</span></span><br><span class="line">   <span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>​        III）@Resource（可以根据类型注入，可以根据名称注入）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource(name = &quot;xxxxx&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>​        IV）@Value（注入普通属性）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(value = &quot;abc&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>

<h6 id="e）完全注解开发"><a href="#e）完全注解开发" class="headerlink" title="e）完全注解开发"></a>e）完全注解开发</h6><p>​        I）创建配置类，替代xml配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;xxxx(包名)&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        II）改变的地方</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig.class);</span><br></pre></td></tr></table></figure>

<h2 id="（二）AOP（面向切面编程）"><a href="#（二）AOP（面向切面编程）" class="headerlink" title="（二）AOP（面向切面编程）"></a>（二）AOP（面向切面编程）</h2><h3 id="1-什么是AOP？"><a href="#1-什么是AOP？" class="headerlink" title="1.什么是AOP？"></a>1.什么是AOP？</h3><p>​    1.面向切面编程，利用AOP对业务逻辑的各个部分进行隔离，从而使得耦合度降低，<br>​    2.通俗地说，不通过修改源代码的方式，在主干功能添加新功能</p>
<h3 id="2-AOP（底层原理）"><a href="#2-AOP（底层原理）" class="headerlink" title="2.AOP（底层原理）"></a>2.AOP（底层原理）</h3><p>​    1.底层使用动态代理（两种情况）</p>
<p>​        I）有接口情况，使用JDK动态代理，创建接口实现类代理对象对UserDaoImpl进行加强</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210509105605079.png" alt="image-20210509105605079"></p>
<p>​        II）无接口情况，使用CGLIB动态代理</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210509105833175.png" alt="image-20210509105833175"></p>
<h3 id="3-JDK动态代理"><a href="#3-JDK动态代理" class="headerlink" title="3.JDK动态代理"></a>3.JDK动态代理</h3><p>​            I）使用JDK动态代理，使用Proxy类里面的方法创建代理对象<br>​            II）调用newProxyInstance方法</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510104757732.png" alt="image-20210510104757732"></p>
<p>​            III）方法有三个参数：<br>​                第一参数，类加载器<br>​                第二参数，增强方法所在的类，这个类实现的接口，支持多个接口<br>​                第三参数，实现这个接口InvocationHandler，创建代理对象，写增强的部分</p>
<p>​            IV）编写JDK动态代理代码</p>
<p>​                a）创建接口，定义方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(String id)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​                b）创建接口实现类，实现方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123; </span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">return</span> a+b; </span><br><span class="line">	&#125; </span><br><span class="line">	<span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(String id)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">return</span> id; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;		</span><br></pre></td></tr></table></figure>

<p>​                c）使用Proxy类创建接口代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">//创建接口实现类代理对象</span></span><br><span class="line">        Class[] interfaces = &#123;UserDao.class&#125;;</span><br><span class="line"><span class="comment">//        Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, new InvocationHandler() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">//                return null;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line">        UserDaoImpl userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">        UserDao dao = (UserDao)Proxy.newProxyInstance(JDKProxy.class.getClassLoader(), interfaces, <span class="keyword">new</span> UserDaoProxy(userDao));</span><br><span class="line">        <span class="keyword">int</span> result = dao.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;result:&quot;</span>+result);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建代理对象代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserDaoProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1 把创建的是谁的代理对象，把谁传递过来</span></span><br><span class="line">    <span class="comment">//有参数构造传递</span></span><br><span class="line">    <span class="keyword">private</span> Object obj;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoProxy</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增强的逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//方法之前</span></span><br><span class="line">        System.out.println(<span class="string">&quot;方法之前执行....&quot;</span>+method.getName()+<span class="string">&quot; :传递的参数...&quot;</span>+ Arrays.toString(args));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//被增强的方法执行</span></span><br><span class="line">        Object res = method.invoke(obj, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法之后</span></span><br><span class="line">        System.out.println(<span class="string">&quot;方法之后执行....&quot;</span>+obj);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-AOP术语"><a href="#4-AOP术语" class="headerlink" title="4.AOP术语"></a>4.AOP术语</h3><p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510125013205.png" alt="image-20210510125013205"></p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510125022951.png" alt="image-20210510125022951"></p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510125031149.png" alt="image-20210510125031149"></p>
<p>​                                 ​<img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510125042640.png" alt="image-20210510125042640">  </p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210510125119539.png" alt="image-20210510125119539"></p>
<h3 id="5-AOP操作"><a href="#5-AOP操作" class="headerlink" title="5.AOP操作"></a>5.AOP操作</h3><h4 id="I）准备"><a href="#I）准备" class="headerlink" title="I）准备"></a>I）准备</h4><p>1.Spring框架一般都是基于AspectJ实现AOP操作<br>    AspectJ不是Spring组成部分，独立AOP框架，一般把AspectJ和Spirng框架一起使用，进行AOP操作<br>2.基于AspectJ实现AOP操作<br>（1）基于xml配置文件实现<br>（2）基于注解方式实现（使用）<br>3.在项目工程里面引入AOP相关依赖<br>4.切入点表达式<br>（1）切入点表达式作用：知道对哪个类里面的哪个方法进行增强<br>（2）语法结构： execution([权限修饰符] [返回类型] [类全路径] [方法名称]([参数列表]) )<br>    举例1：对com.atguigu.dao.BookDao类里面的add进行增强<br>    execution(* com.atguigu.dao.BookDao.add(..))<br>    举例2：对com.atguigu.dao.BookDao类里面的所有的方法进行增强<br>    execution(* com.atguigu.dao.BookDao.* (..))<br>    举例3：对com.atguigu.dao包里面所有类，类里面所有方法进行增强<br>    execution(* com.atguigu.dao.<em>.</em> (..))</p>
<h4 id="II）AspectJ注解"><a href="#II）AspectJ注解" class="headerlink" title="II）AspectJ注解"></a>II）AspectJ注解</h4><p>​    <strong>1.创建类，在类里面定义方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;add...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    <strong>2.创建增强类（编写增强逻辑）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3Proxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    <strong>3.进行通知的配置</strong></p>
<p>​        （1）在spring配置文件中，开启注解扫描<br>​        （2）使用注解创建User和UserProxy对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3Proxy</span> </span></span><br><span class="line"><span class="class">@<span class="title">Component</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">User3</span></span></span><br></pre></td></tr></table></figure>

<p>​        （3）在增强类上面添加注解 @Aspect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3Proxy</span> </span></span><br></pre></td></tr></table></figure>

<p>​        （4）在spring配置文件中开启生成代理对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启Aspect生成代理对象--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    <strong>4.配置不同类型的通知</strong></p>
<p>​        （1）在增强类的里面，在作为通知方法上面添加通知类型注解，使用切入点表达式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3Proxy</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回值之后执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 怎样都执行</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="meta">@After(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterThrowing..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Around1..&quot;</span>);</span><br><span class="line">        proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;Around2..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5.相同切入点抽取</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User3Proxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(value = &quot;execution(* AnnoAop.User3.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">point</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(value = &quot;point()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回值之后执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;point()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(value = &quot;point()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;point()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTrowing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterThrowing..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(value = &quot;point()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Around1..&quot;</span>);</span><br><span class="line">        proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;Around2..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6.有多个增强类对同一个方法增强时，设置增强类的优先级</strong></p>
<p>在增强类上面添加注解 @Order(数字类型值)，数字类型值越小优先级越高</p>
<p><strong>7.完全使用注解开发</strong></p>
<p>创建配置类，不需要创建xml配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;aopxml&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigAop</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="III）AspectJ配置文件"><a href="#III）AspectJ配置文件" class="headerlink" title="III）AspectJ配置文件"></a>III）AspectJ配置文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;buy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aopxml.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookProxy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aopxml.BookProxy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;buy&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* aopxml.Book.buy(..))&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;bookProxy&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;buy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="（三）JdbcTemplate"><a href="#（三）JdbcTemplate" class="headerlink" title="（三）JdbcTemplate"></a>（三）JdbcTemplate</h2><h3 id="1-什么是JdbcTemplate"><a href="#1-什么是JdbcTemplate" class="headerlink" title="1.什么是JdbcTemplate"></a>1.什么是JdbcTemplate</h3><p>Spring框架对JDBC进行封装，使用JdbcTemplate方便实现对数据库操作</p>
<h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2.准备工作"></a>2.准备工作</h3><p>I）引入相关jar包</p>
<p>II）在spring配置文件配置数据库连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///user_db&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>III）配置JdbcTemplate对象，注入DataSource</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JdbcTemplate对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>IV）创建service类，创建dao类，在dao注入jdbcTemplate对象</p>
<p>*配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;Spirng5_2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>*Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book2Service</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Book2Dao book2Dao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*Dao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book2Impl</span> <span class="keyword">implements</span> <span class="title">Book2Dao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-添加操作"><a href="#3-添加操作" class="headerlink" title="3.添加操作"></a>3.添加操作</h3><p>1.对应数据库创建实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String UserId;</span><br><span class="line">    <span class="keyword">private</span> String UserName;</span><br><span class="line">    <span class="keyword">private</span> String UStatus;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UserName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        UserName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UserId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        UserId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUStatus</span><span class="params">(String UStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.UStatus = UStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User4&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;UserId=&#x27;&quot;</span> + UserId + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, UserName=&#x27;&quot;</span> + UserName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, UStatus=&#x27;&quot;</span> + UStatus + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.编写service和dao<br>（1）在dao进行数据库添加操作<br>（2）调用JdbcTemplate对象里面update方法实现添加操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String Book2Id;</span><br><span class="line">    <span class="keyword">private</span> String Book2Name;</span><br><span class="line">    <span class="keyword">private</span> String BStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Book2&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Book2Id=&#x27;&quot;</span> + Book2Id + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, Book2Name=&#x27;&quot;</span> + Book2Name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, BStatus=&#x27;&quot;</span> + BStatus + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook2Id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Book2Id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook2Id</span><span class="params">(String book2Id)</span> </span>&#123;</span><br><span class="line">        Book2Id = book2Id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook2Name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Book2Name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook2Name</span><span class="params">(String book2Name)</span> </span>&#123;</span><br><span class="line">        Book2Name = book2Name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBStatus</span><span class="params">(String BStatus)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.BStatus = BStatus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Book2Dao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Book2 book2)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book2Impl</span> <span class="keyword">implements</span> <span class="title">Book2Dao</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Book2 book2)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into t_book values (?,?,?)&quot;</span>;</span><br><span class="line">        Object[] args = &#123;book2.getBook2Id(), book2.getBook2Name(), book2.getBStatus()&#125;;</span><br><span class="line">        <span class="keyword">int</span> update = jdbcTemplate.update(sql, args);</span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book2Service</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Book2Dao book2Dao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book2 book2)</span> </span>&#123;</span><br><span class="line">        book2Dao.add(book2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean6.xml&quot;</span>);</span><br><span class="line">        Book2Service book2Service = applicationContext.getBean(<span class="string">&quot;book2Service&quot;</span>, Book2Service.class);</span><br><span class="line">        Book2 book2 = <span class="keyword">new</span> Book2();</span><br><span class="line">        book2.setBook2Id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        book2.setBook2Name(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        book2.setBStatus(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        book2Service.addBook(book2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-修改和删除"><a href="#4-修改和删除" class="headerlink" title="4.修改和删除"></a>4.修改和删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123; </span><br><span class="line">	String sql = <span class="string">&quot;update t_book set username=?,ustatus=? where user_id=?&quot;</span>; </span><br><span class="line">	Object[] args = &#123;book.getUsername(), book.getUstatus(),book.getUserId()&#125;; </span><br><span class="line">	<span class="keyword">int</span> update = jdbcTemplate.update(sql, args); </span><br><span class="line">	System.out.println(update); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String id)</span> </span>&#123; </span><br><span class="line">	String sql = <span class="string">&quot;delete from t_book where user_id=?&quot;</span>; </span><br><span class="line">	<span class="keyword">int</span> update = jdbcTemplate.update(sql, id); </span><br><span class="line">	System.out.println(update); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-查询"><a href="#5-查询" class="headerlink" title="5.查询"></a>5.查询</h3><h3 id="6-事务"><a href="#6-事务" class="headerlink" title="6.事务"></a>6.事务</h3><h4 id="I）什么是事务"><a href="#I）什么是事务" class="headerlink" title="I）什么是事务"></a>I）什么是事务</h4><p>（1）事务是数据库操作最基本单元，逻辑上一组操作，要么都成功，如果有一个失败所有操作都失败</p>
<p>（2）典型场景：银行转账</p>
<p>​        lucy 转账100元 </p>
<p>​        给marylucy少100，mary多100</p>
<h4 id="II-事务四个特性（ACID）"><a href="#II-事务四个特性（ACID）" class="headerlink" title="II)事务四个特性（ACID）"></a>II)事务四个特性（ACID）</h4><p>（1）原子性<br>（2）一致性<br>（3）隔离性<br>（4）持久性</p>
<h4 id="III）搭建事务操作环境"><a href="#III）搭建事务操作环境" class="headerlink" title="III）搭建事务操作环境"></a>III）搭建事务操作环境</h4><p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512193950200.png" alt="image-20210512193950200"></p>
<p>1、创建数据库表，添加记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123; </span><br><span class="line">    <span class="comment">//注入dao @Autowired private UserDao userDao; </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、创建service，搭建dao，完成对象创建和注入关系<br>（1）service注入dao，在dao注入JdbcTemplate，在JdbcTemplate注入DataSource</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate; </span><br><span class="line">    <span class="comment">//lucy转账100给mary </span></span><br><span class="line">    <span class="comment">//少钱 </span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduceMoney</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        String sql = <span class="string">&quot;update t_account set money=money-? where username=?&quot;</span>; 			jdbcTemplate.update(sql,<span class="number">100</span>,<span class="string">&quot;lucy&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//多钱</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMoney</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        String sql = <span class="string">&quot;update t_account set money=money+? where username=?&quot;</span>; 			jdbcTemplate.update(sql,<span class="number">100</span>,<span class="string">&quot;mary&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123; </span><br><span class="line">    <span class="comment">//注入dao </span></span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> UserDao userDao; </span><br><span class="line">    <span class="comment">//转账的方法 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accountMoney</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="comment">//lucy少100 </span></span><br><span class="line">        userDao.reduceMoney(); </span><br><span class="line">        <span class="comment">//mary多100 </span></span><br><span class="line">        userDao.addMoney(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、上面代码，如果正常执行没有问题的，但是如果代码执行过程中出现异常，有问题</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512194345047.png" alt="image-20210512194345047"></p>
<h4 id="IV）Spring中的事务"><a href="#IV）Spring中的事务" class="headerlink" title="IV）Spring中的事务"></a>IV）Spring中的事务</h4><p>1.事务添加到JavaEE三层结构里面Service层（业务逻辑层）</p>
<p>2.在Spring进行事务管理操作<br>    有两种方式：编程式事务管理和<strong>声明式事务管理</strong>（使用）</p>
<p>3.声明式事务管理<br>（1）<strong>基于注解方式</strong>（使用）<br>（2）基于xml配置文件方式</p>
<p>4、在Spring进行声明式事务管理，底层使用<strong>AOP原理</strong></p>
<h4 id="V）注解声明式事务管理"><a href="#V）注解声明式事务管理" class="headerlink" title="V）注解声明式事务管理"></a>V）注解声明式事务管理</h4><h5 id="1-在spring配置文件配置事务管理器"><a href="#1-在spring配置文件配置事务管理器" class="headerlink" title="1.在spring配置文件配置事务管理器"></a>1.在spring配置文件配置事务管理器</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--创建事务管理器--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!--注入数据源--&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-在spring配置文件，开启事务注解"><a href="#2-在spring配置文件，开启事务注解" class="headerlink" title="2.在spring配置文件，开启事务注解"></a>2.在spring配置文件，开启事务注解</h5><p>（1）在spring配置文件引入名称空间 tx</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchemainstance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）开启事务注解 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启事务注解--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-在service类上面（或者service类里面方法上面）添加事务注解"><a href="#3-在service类上面（或者service类里面方法上面）添加事务注解" class="headerlink" title="3.在service类上面（或者service类里面方法上面）添加事务注解"></a>3.在service类上面（或者service类里面方法上面）添加事务注解</h5><p>（1）@Transactional，这个注解添加到类上面，也可以添加方法上面<br>（2）如果把这个注解添加类上面，这个类里面所有的方法都添加事务<br>（3）如果把这个注解添加方法上面，为这个方法添加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span> </span><br><span class="line"><span class="meta">@Transactional</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<h5 id="4-注解-Transactional配置事务相关参数"><a href="#4-注解-Transactional配置事务相关参数" class="headerlink" title="4.注解@Transactional配置事务相关参数"></a>4.注解@Transactional配置事务相关参数</h5><p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512201539740.png" alt="image-20210512201539740"></p>
<p>I）propagation：事务传播行为<br>    （1）多事务方法直接进行调用，这个过程中事务 是如何进行管理的</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512201654267.png" alt="image-20210512201654267"></p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512201702778.png" alt="image-20210512201702778"></p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512201713192.png" alt="image-20210512201713192"></p>
<p>II）ioslation：事务隔离级别</p>
<p>（1）事务有特性成为隔离性，多事务操作之间不会产生影响。不考虑隔离性产生很多问题<br>（2）有三个读问题：脏读、不可重复读、虚（幻）读<br>（3）脏读：一个未提交事务读取到另一个未提交事务的数据</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512202217135.png" alt="image-20210512202217135"></p>
<p>（4）不可重复读：一个未提交事务读取到另一提交事务修改数据</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512202259234.png" alt="image-20210512202259234"></p>
<p>（5）虚读：一个未提交事务读取到另一提交事务添加数据<br>（6）解决：通过设置事务隔离级别，解决读问题</p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512202404616.png" alt="image-20210512202404616"></p>
<p><img src="/2021/05/07/Spring/Users\zzz\AppData\Roaming\Typora\typora-user-images\image-20210512202416396.png" alt="image-20210512202416396"></p>
<p>III）timeout：超时时间<br>（1）事务需要在一定时间内进行提交，如果不提交进行回滚<br>（2）默认值是 -1 ，设置时间以秒单位进行计算<br>IV）readOnly：是否只读<br>（1）读：查询操作，写：添加修改删除操作<br>（2）readOnly默认值false，表示可以查询，可以添加修改删除操作<br>（3）设置readOnly值是true，设置成true之后，只能查询<br>V）rollbackFor：回滚<br>（1）设置出现哪些异常进行事务回滚<br>VI）noRollbackFor：不回滚<br>（1)设置出现哪些异常不进行事务回滚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="pupil"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">pupil</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">pupil</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
